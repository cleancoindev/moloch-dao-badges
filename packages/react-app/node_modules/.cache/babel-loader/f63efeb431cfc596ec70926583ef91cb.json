{"ast":null,"code":"var looper = require('looper');\n\nmodule.exports = function (writer, ender) {\n  return function (read) {\n    var queue = [],\n        ended,\n        error;\n\n    function enqueue(data) {\n      queue.push(data);\n    }\n\n    writer = writer || function (data) {\n      this.queue(data);\n    };\n\n    ender = ender || function () {\n      this.queue(null);\n    };\n\n    var emitter = {\n      emit: function (event, data) {\n        if (event == 'data') enqueue(data);\n        if (event == 'end') ended = true, enqueue(null);\n        if (event == 'error') error = data;\n      },\n      queue: enqueue\n    };\n\n    var _cb;\n\n    return function (end, cb) {\n      ended = ended || end;\n      if (end) return read(end, function () {\n        if (_cb) {\n          var t = _cb;\n          _cb = null;\n          t(end);\n        }\n\n        cb(end);\n      });\n      _cb = cb;\n      looper(function pull(next) {\n        //if it's an error\n        if (!_cb) return;\n        cb = _cb;\n        if (error) _cb = null, cb(error);else if (queue.length) {\n          var data = queue.shift();\n          _cb = null, cb(data === null, data);\n        } else {\n          read(ended, function (end, data) {\n            //null has no special meaning for pull-stream\n            if (end && end !== true) {\n              error = end;\n              return next();\n            }\n\n            if (ended = ended || end) ender.call(emitter);else if (data !== null) {\n              writer.call(emitter, data);\n              if (error || ended) return read(error || ended, function () {\n                _cb = null;\n                cb(error || ended);\n              });\n            }\n            next(pull);\n          });\n        }\n      });\n    };\n  };\n};","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/pull-through/index.js"],"names":["looper","require","module","exports","writer","ender","read","queue","ended","error","enqueue","data","push","emitter","emit","event","_cb","end","cb","t","pull","next","length","shift","call"],"mappings":"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","sourcesContent":["var looper = require('looper')\n\nmodule.exports = function (writer, ender) {\n  return function (read) {\n    var queue = [], ended, error\n\n    function enqueue (data) {\n      queue.push(data)\n    }\n\n    writer = writer || function (data) {\n      this.queue(data)\n    }\n\n    ender = ender || function () {\n      this.queue(null)\n    }\n\n    var emitter = {\n      emit: function (event, data) {\n        if(event == 'data') enqueue(data)\n        if(event == 'end')  ended = true, enqueue(null)\n        if(event == 'error') error = data\n      },\n      queue: enqueue\n    }\n    var _cb\n    return function (end, cb) {\n      ended = ended || end\n      if(end)\n        return read(end, function () {\n          if(_cb) {\n            var t = _cb; _cb = null; t(end)\n          }\n          cb(end)\n        })\n\n      _cb = cb\n      looper(function pull (next) {\n        //if it's an error\n        if(!_cb) return\n        cb = _cb\n        if(error) _cb = null, cb(error)\n        else if(queue.length) {\n          var data = queue.shift()\n          _cb = null,cb(data === null, data)\n        }\n        else {\n          read(ended, function (end, data) {\n             //null has no special meaning for pull-stream\n            if(end && end !== true) {\n              error = end; return next()\n            }\n            if(ended = ended || end)  ender.call(emitter)\n            else if(data !== null) {\n              writer.call(emitter, data)\n              if(error || ended)\n                return read(error || ended, function () {\n                  _cb = null; cb(error || ended)\n                })\n            }\n            next(pull)\n          })\n        }\n      })\n    }\n  }\n}\n\n"]},"metadata":{},"sourceType":"script"}