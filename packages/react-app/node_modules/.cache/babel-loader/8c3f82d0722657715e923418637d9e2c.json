{"ast":null,"code":"'use strict';\n\nconst series = require('async/series');\n\nconst propose = require('./propose');\n\nconst exchange = require('./exchange');\n\nconst finish = require('./finish'); // Performs initial communication over insecure channel to share keys, IDs,\n// and initiate communication, assigning all necessary params.\n\n\nmodule.exports = function handshake(state, callback) {\n  series([cb => propose(state, cb), cb => exchange(state, cb), cb => finish(state, cb)], err => {\n    state.cleanSecrets();\n\n    if (err) {\n      if (err === true) {\n        err = new Error('Stream ended prematurely');\n      }\n\n      state.shake.abort(err);\n    } // signal when the handshake is finished so that plumbing can happen\n\n\n    callback(err);\n  });\n  return state.stream;\n};","map":{"version":3,"sources":["/home/samkuhlmann/Documents/ody/moloch/moloch-dao-badges/node_modules/libp2p-secio/src/handshake/index.js"],"names":["series","require","propose","exchange","finish","module","exports","handshake","state","callback","cb","err","cleanSecrets","Error","shake","abort","stream"],"mappings":"AAAA;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,cAAD,CAAtB;;AAEA,MAAMC,OAAO,GAAGD,OAAO,CAAC,WAAD,CAAvB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAC,YAAD,CAAxB;;AACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAAtB,C,CAEA;AACA;;;AACAI,MAAM,CAACC,OAAP,GAAiB,SAASC,SAAT,CAAoBC,KAApB,EAA2BC,QAA3B,EAAqC;AACpDT,EAAAA,MAAM,CAAC,CACJU,EAAD,IAAQR,OAAO,CAACM,KAAD,EAAQE,EAAR,CADV,EAEJA,EAAD,IAAQP,QAAQ,CAACK,KAAD,EAAQE,EAAR,CAFX,EAGJA,EAAD,IAAQN,MAAM,CAACI,KAAD,EAAQE,EAAR,CAHT,CAAD,EAIFC,GAAD,IAAS;AACVH,IAAAA,KAAK,CAACI,YAAN;;AAEA,QAAID,GAAJ,EAAS;AACP,UAAIA,GAAG,KAAK,IAAZ,EAAkB;AAChBA,QAAAA,GAAG,GAAG,IAAIE,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACDL,MAAAA,KAAK,CAACM,KAAN,CAAYC,KAAZ,CAAkBJ,GAAlB;AACD,KARS,CAUV;;;AACAF,IAAAA,QAAQ,CAACE,GAAD,CAAR;AACD,GAhBK,CAAN;AAkBA,SAAOH,KAAK,CAACQ,MAAb;AACD,CApBD","sourcesContent":["'use strict'\n\nconst series = require('async/series')\n\nconst propose = require('./propose')\nconst exchange = require('./exchange')\nconst finish = require('./finish')\n\n// Performs initial communication over insecure channel to share keys, IDs,\n// and initiate communication, assigning all necessary params.\nmodule.exports = function handshake (state, callback) {\n  series([\n    (cb) => propose(state, cb),\n    (cb) => exchange(state, cb),\n    (cb) => finish(state, cb)\n  ], (err) => {\n    state.cleanSecrets()\n\n    if (err) {\n      if (err === true) {\n        err = new Error('Stream ended prematurely')\n      }\n      state.shake.abort(err)\n    }\n\n    // signal when the handshake is finished so that plumbing can happen\n    callback(err)\n  })\n\n  return state.stream\n}\n"]},"metadata":{},"sourceType":"script"}