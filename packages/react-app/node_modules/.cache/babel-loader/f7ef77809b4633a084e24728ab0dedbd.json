{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar _require = require('./utils/index'),\n    throwIfUndefined = _require.throwIfUndefined,\n    throwIfNotEqualLenArrays = _require.throwIfNotEqualLenArrays;\n\nvar KeyValueStore = /*#__PURE__*/function () {\n  /**\n   * Please use **box.public** or **box.private** to get the instance of this class\n   */\n  function KeyValueStore(name, replicator, threeId) {\n    (0, _classCallCheck2[\"default\"])(this, KeyValueStore);\n    this._name = name;\n    this._replicator = replicator;\n\n    if (this._name.startsWith('3box.space.')) {\n      this._space = this._name.split('.')[2];\n    }\n\n    this._3id = threeId;\n  }\n  /**\n   * Get the value and optionally metadata of the given key\n   *\n   * @param     {String}    key                             the key\n   * @param     {Object}    opts                            optional parameters\n   * @param     {Boolean}   opts.metadata                   return both value and metadata\n   * @return    {String|{value: String, timestamp: Number}} the value associated with the key, undefined if there's no such key\n   */\n\n\n  (0, _createClass2[\"default\"])(KeyValueStore, [{\n    key: \"get\",\n    value: function () {\n      var _get2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(key) {\n        var opts,\n            x,\n            metadata,\n            _args = arguments;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                opts = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n                _context.next = 3;\n                return this._get(key);\n\n              case 3:\n                x = _context.sent;\n\n                if (x) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", x);\n\n              case 6:\n                if (!opts.metadata) {\n                  _context.next = 9;\n                  break;\n                }\n\n                metadata = this._extractMetadata(x);\n                return _context.abrupt(\"return\", _objectSpread({}, metadata, {\n                  value: x.value\n                }));\n\n              case 9:\n                return _context.abrupt(\"return\", x.value);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function get(_x) {\n        return _get2.apply(this, arguments);\n      }\n\n      return get;\n    }()\n    /**\n     * Get metadata for for a given key\n     *\n     * @param     {String}    key                     the key\n     * @return    {Metadata}                          Metadata for the key, undefined if there's no such key\n     */\n\n  }, {\n    key: \"getMetadata\",\n    value: function () {\n      var _getMetadata = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(key) {\n        var x;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this._get(key);\n\n              case 2:\n                x = _context2.sent;\n\n                if (x) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", x);\n\n              case 5:\n                return _context2.abrupt(\"return\", this._extractMetadata(x));\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getMetadata(_x2) {\n        return _getMetadata.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }()\n    /**\n     * Set a value for the given key\n     *\n     * @param     {String}    key                     the key\n     * @param     {String}    value                   the value\n     * @return    {Boolean}                           true if successful\n     */\n\n  }, {\n    key: \"set\",\n    value: function () {\n      var _set = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(key, value) {\n        var timeStamp;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                timeStamp = new Date().getTime();\n                _context3.next = 6;\n                return this._db.put(key, {\n                  value: value,\n                  timeStamp: timeStamp\n                });\n\n              case 6:\n                return _context3.abrupt(\"return\", true);\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function set(_x3, _x4) {\n        return _set.apply(this, arguments);\n      }\n\n      return set;\n    }()\n    /**\n    * Set multiple values for multiple keys\n    *\n    * @param     {Array<String>}    keys                     the keys\n    * @param     {Array<String>}    values                   the values\n    * @return    {Boolean}                                  true if successful, throw error if not\n    */\n\n  }, {\n    key: \"setMultiple\",\n    value: function () {\n      var _setMultiple = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(keys, values) {\n        var _this = this;\n\n        return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                _context5.prev = 3;\n                _context5.next = 6;\n                return keys.reduce( /*#__PURE__*/function () {\n                  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(previousPromise, nextKey, index) {\n                    var timeStamp;\n                    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _context4.next = 2;\n                            return previousPromise;\n\n                          case 2:\n                            throwIfUndefined(nextKey, 'key');\n                            timeStamp = new Date().getTime();\n                            return _context4.abrupt(\"return\", _this._db.put(nextKey, {\n                              value: values[index],\n                              timeStamp: timeStamp\n                            }));\n\n                          case 5:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x7, _x8, _x9) {\n                    return _ref.apply(this, arguments);\n                  };\n                }(), Promise.resolve());\n\n              case 6:\n                return _context5.abrupt(\"return\", true);\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](3);\n                throw new Error(_context5.t0);\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[3, 9]]);\n      }));\n\n      function setMultiple(_x5, _x6) {\n        return _setMultiple.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }()\n    /**\n     * Remove the value for the given key\n     *\n     * @param     {String}    key                     the key\n     * @return    {Boolean}                           true if successful\n     */\n\n  }, {\n    key: \"remove\",\n    value: function () {\n      var _remove = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(key) {\n        return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                _context6.next = 5;\n                return this._db.del(key);\n\n              case 5:\n                return _context6.abrupt(\"return\", true);\n\n              case 6:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function remove(_x10) {\n        return _remove.apply(this, arguments);\n      }\n\n      return remove;\n    }()\n    /**\n     * Extract metadata from store object\n     * @private\n     * @param x {Object} data from store\n     * @return {Metadata} store metadata\n     */\n\n  }, {\n    key: \"_extractMetadata\",\n    value: function _extractMetadata(x) {\n      // ms -> seconds, see issue #396 for details\n      var timestamp = Math.floor(x.timeStamp / 1000);\n      return {\n        timestamp: timestamp\n      };\n    }\n    /**\n     * Get the raw value of the given key\n     * @private\n     *\n     * @param     {String}    key                     the key\n     * @return    {String}                            the value associated with the key\n     */\n\n  }, {\n    key: \"_get\",\n    value: function () {\n      var _get3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(key) {\n        return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                this._requireLoad();\n\n                return _context7.abrupt(\"return\", this._db.get(key));\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _get(_x11) {\n        return _get3.apply(this, arguments);\n      }\n\n      return _get;\n    }()\n  }, {\n    key: \"_sync\",\n    value: function () {\n      var _sync2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8() {\n        return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                this._requireLoad();\n\n                _context8.next = 3;\n                return this._replicator.syncDB(this._db);\n\n              case 3:\n                return _context8.abrupt(\"return\", this._db.address.toString());\n\n              case 4:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function _sync() {\n        return _sync2.apply(this, arguments);\n      }\n\n      return _sync;\n    }()\n  }, {\n    key: \"_load\",\n    value: function () {\n      var _load2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(threeId) {\n        var _this2 = this;\n\n        var odbAddress, key, odbIdentity;\n        return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                this._3id = threeId || this._3id;\n                odbAddress = this._replicator.listStoreAddresses().find(function (odbAddress) {\n                  return odbAddress.includes(_this2._name);\n                });\n\n                if (!odbAddress) {\n                  _context9.next = 8;\n                  break;\n                }\n\n                _context9.next = 5;\n                return this._replicator.getStore(odbAddress);\n\n              case 5:\n                this._db = _context9.sent;\n                _context9.next = 14;\n                break;\n\n              case 8:\n                _context9.next = 10;\n                return this._3id.getPublicKeys(this._space, true);\n\n              case 10:\n                key = _context9.sent.signingKey;\n                _context9.next = 13;\n                return this._replicator.addKVStore(this._name, key, Boolean(this._space), this._3id.getSubDID(this._space));\n\n              case 13:\n                this._db = _context9.sent;\n\n              case 14:\n                _context9.next = 16;\n                return this._3id.getOdbId(this._space);\n\n              case 16:\n                odbIdentity = _context9.sent;\n\n                this._db.setIdentity(odbIdentity);\n\n                return _context9.abrupt(\"return\", this._db.address.toString());\n\n              case 19:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function _load(_x12) {\n        return _load2.apply(this, arguments);\n      }\n\n      return _load;\n    }()\n  }, {\n    key: \"_requireLoad\",\n    value: function _requireLoad() {\n      if (!this._db) throw new Error('_load must be called before interacting with the store');\n    }\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee10() {\n        return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                this._requireLoad();\n\n                _context10.next = 3;\n                return this._db.close();\n\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function close() {\n        return _close.apply(this, arguments);\n      }\n\n      return close;\n    }()\n    /**\n     * Get all values and optionally metadata\n     *\n     * @param     {Object}    opts                                    optional parameters\n     * @param     {Boolean}   opts.metadata                           return both values and metadata\n     * @return    {Array<String|{value: String, timestamp: Number}>}  the values\n     */\n\n  }, {\n    key: \"all\",\n    value: function () {\n      var _all = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee11() {\n        var _this3 = this;\n\n        var opts,\n            entries,\n            allSimple,\n            _args11 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                opts = _args11.length > 0 && _args11[0] !== undefined ? _args11[0] : {};\n\n                this._requireLoad();\n\n                entries = this._db.all;\n                allSimple = {};\n                Object.keys(entries).map(function (key) {\n                  var entry = entries[key];\n\n                  if (opts.metadata) {\n                    allSimple[key] = _objectSpread({}, _this3._extractMetadata(entry), {\n                      value: entry.value\n                    });\n                  } else {\n                    allSimple[key] = entry.value;\n                  }\n                });\n                return _context11.abrupt(\"return\", allSimple);\n\n              case 6:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function all() {\n        return _all.apply(this, arguments);\n      }\n\n      return all;\n    }()\n    /**\n     * Returns array of underlying log entries. In linearized order according to their Lamport clocks.\n     * Useful for generating a complete history of all operations on store.\n     *\n     *  @example\n     *  const log = store.log\n     *  const entry = log[0]\n     *  console.log(entry)\n     *  // { op: 'PUT', key: 'Name', value: 'Botbot', timeStamp: '1538575416068' }\n     *\n     * @return    {Array<Object>}     Array of ordered log entry objects\n     */\n\n  }, {\n    key: \"log\",\n    value: function () {\n      var _log = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee12() {\n        return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                return _context12.abrupt(\"return\", this._db._oplog.values.map(function (obj) {\n                  return {\n                    op: obj.payload.op,\n                    key: obj.payload.key,\n                    value: obj.payload.value ? obj.payload.value.value : null,\n                    timeStamp: obj.payload.value ? obj.payload.value.timeStamp : null\n                  };\n                }));\n\n              case 1:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function log() {\n        return _log.apply(this, arguments);\n      }\n\n      return log;\n    }()\n  }]);\n  return KeyValueStore;\n}();\n\nmodule.exports = KeyValueStore;","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/3box/lib/keyValueStore.js"],"names":["_interopRequireDefault","require","_regenerator","_defineProperty2","_asyncToGenerator2","_classCallCheck2","_createClass2","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","_require","throwIfUndefined","throwIfNotEqualLenArrays","KeyValueStore","name","replicator","threeId","_name","_replicator","startsWith","_space","split","_3id","value","_get2","mark","_callee","opts","x","metadata","_args","wrap","_callee$","_context","prev","next","undefined","_get","sent","abrupt","_extractMetadata","stop","get","_x","_getMetadata","_callee2","_callee2$","_context2","getMetadata","_x2","_set","_callee3","timeStamp","_callee3$","_context3","_requireLoad","ensureConnected","_db","address","toString","Date","getTime","put","set","_x3","_x4","_setMultiple","_callee5","values","_this","_callee5$","_context5","reduce","_ref","_callee4","previousPromise","nextKey","index","_callee4$","_context4","_x7","_x8","_x9","Promise","resolve","t0","Error","setMultiple","_x5","_x6","_remove","_callee6","_callee6$","_context6","del","remove","_x10","timestamp","Math","floor","_get3","_callee7","_callee7$","_context7","_x11","_sync2","_callee8","_callee8$","_context8","syncDB","_sync","_load2","_callee9","_this2","odbAddress","odbIdentity","_callee9$","_context9","listStoreAddresses","find","includes","getStore","getPublicKeys","signingKey","addKVStore","Boolean","getSubDID","getOdbId","setIdentity","_load","_x12","_close","_callee10","_callee10$","_context10","close","_all","_callee11","_this3","entries","allSimple","_args11","_callee11$","_context11","all","map","entry","_log","_callee12","_callee12$","_context12","_oplog","obj","op","payload","log","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _require = require('./utils/index'),\n    throwIfUndefined = _require.throwIfUndefined,\n    throwIfNotEqualLenArrays = _require.throwIfNotEqualLenArrays;\n\nvar KeyValueStore =\n/*#__PURE__*/\nfunction () {\n  /**\n   * Please use **box.public** or **box.private** to get the instance of this class\n   */\n  function KeyValueStore(name, replicator, threeId) {\n    (0, _classCallCheck2[\"default\"])(this, KeyValueStore);\n    this._name = name;\n    this._replicator = replicator;\n\n    if (this._name.startsWith('3box.space.')) {\n      this._space = this._name.split('.')[2];\n    }\n\n    this._3id = threeId;\n  }\n  /**\n   * Get the value and optionally metadata of the given key\n   *\n   * @param     {String}    key                             the key\n   * @param     {Object}    opts                            optional parameters\n   * @param     {Boolean}   opts.metadata                   return both value and metadata\n   * @return    {String|{value: String, timestamp: Number}} the value associated with the key, undefined if there's no such key\n   */\n\n\n  (0, _createClass2[\"default\"])(KeyValueStore, [{\n    key: \"get\",\n    value: function () {\n      var _get2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee(key) {\n        var opts,\n            x,\n            metadata,\n            _args = arguments;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                opts = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n                _context.next = 3;\n                return this._get(key);\n\n              case 3:\n                x = _context.sent;\n\n                if (x) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", x);\n\n              case 6:\n                if (!opts.metadata) {\n                  _context.next = 9;\n                  break;\n                }\n\n                metadata = this._extractMetadata(x);\n                return _context.abrupt(\"return\", _objectSpread({}, metadata, {\n                  value: x.value\n                }));\n\n              case 9:\n                return _context.abrupt(\"return\", x.value);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function get(_x) {\n        return _get2.apply(this, arguments);\n      }\n\n      return get;\n    }()\n    /**\n     * Get metadata for for a given key\n     *\n     * @param     {String}    key                     the key\n     * @return    {Metadata}                          Metadata for the key, undefined if there's no such key\n     */\n\n  }, {\n    key: \"getMetadata\",\n    value: function () {\n      var _getMetadata = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee2(key) {\n        var x;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this._get(key);\n\n              case 2:\n                x = _context2.sent;\n\n                if (x) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", x);\n\n              case 5:\n                return _context2.abrupt(\"return\", this._extractMetadata(x));\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getMetadata(_x2) {\n        return _getMetadata.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }()\n    /**\n     * Set a value for the given key\n     *\n     * @param     {String}    key                     the key\n     * @param     {String}    value                   the value\n     * @return    {Boolean}                           true if successful\n     */\n\n  }, {\n    key: \"set\",\n    value: function () {\n      var _set = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee3(key, value) {\n        var timeStamp;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                timeStamp = new Date().getTime();\n                _context3.next = 6;\n                return this._db.put(key, {\n                  value: value,\n                  timeStamp: timeStamp\n                });\n\n              case 6:\n                return _context3.abrupt(\"return\", true);\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function set(_x3, _x4) {\n        return _set.apply(this, arguments);\n      }\n\n      return set;\n    }()\n    /**\n    * Set multiple values for multiple keys\n    *\n    * @param     {Array<String>}    keys                     the keys\n    * @param     {Array<String>}    values                   the values\n    * @return    {Boolean}                                  true if successful, throw error if not\n    */\n\n  }, {\n    key: \"setMultiple\",\n    value: function () {\n      var _setMultiple = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee5(keys, values) {\n        var _this = this;\n\n        return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                _context5.prev = 3;\n                _context5.next = 6;\n                return keys.reduce(\n                /*#__PURE__*/\n                function () {\n                  var _ref = (0, _asyncToGenerator2[\"default\"])(\n                  /*#__PURE__*/\n                  _regenerator[\"default\"].mark(function _callee4(previousPromise, nextKey, index) {\n                    var timeStamp;\n                    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _context4.next = 2;\n                            return previousPromise;\n\n                          case 2:\n                            throwIfUndefined(nextKey, 'key');\n                            timeStamp = new Date().getTime();\n                            return _context4.abrupt(\"return\", _this._db.put(nextKey, {\n                              value: values[index],\n                              timeStamp: timeStamp\n                            }));\n\n                          case 5:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x7, _x8, _x9) {\n                    return _ref.apply(this, arguments);\n                  };\n                }(), Promise.resolve());\n\n              case 6:\n                return _context5.abrupt(\"return\", true);\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](3);\n                throw new Error(_context5.t0);\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[3, 9]]);\n      }));\n\n      function setMultiple(_x5, _x6) {\n        return _setMultiple.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }()\n    /**\n     * Remove the value for the given key\n     *\n     * @param     {String}    key                     the key\n     * @return    {Boolean}                           true if successful\n     */\n\n  }, {\n    key: \"remove\",\n    value: function () {\n      var _remove = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee6(key) {\n        return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n\n                this._requireLoad();\n\n                this._replicator.ensureConnected(this._db.address.toString());\n\n                _context6.next = 5;\n                return this._db.del(key);\n\n              case 5:\n                return _context6.abrupt(\"return\", true);\n\n              case 6:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function remove(_x10) {\n        return _remove.apply(this, arguments);\n      }\n\n      return remove;\n    }()\n    /**\n     * Extract metadata from store object\n     * @private\n     * @param x {Object} data from store\n     * @return {Metadata} store metadata\n     */\n\n  }, {\n    key: \"_extractMetadata\",\n    value: function _extractMetadata(x) {\n      // ms -> seconds, see issue #396 for details\n      var timestamp = Math.floor(x.timeStamp / 1000);\n      return {\n        timestamp: timestamp\n      };\n    }\n    /**\n     * Get the raw value of the given key\n     * @private\n     *\n     * @param     {String}    key                     the key\n     * @return    {String}                            the value associated with the key\n     */\n\n  }, {\n    key: \"_get\",\n    value: function () {\n      var _get3 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee7(key) {\n        return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                this._requireLoad();\n\n                return _context7.abrupt(\"return\", this._db.get(key));\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _get(_x11) {\n        return _get3.apply(this, arguments);\n      }\n\n      return _get;\n    }()\n  }, {\n    key: \"_sync\",\n    value: function () {\n      var _sync2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee8() {\n        return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                this._requireLoad();\n\n                _context8.next = 3;\n                return this._replicator.syncDB(this._db);\n\n              case 3:\n                return _context8.abrupt(\"return\", this._db.address.toString());\n\n              case 4:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function _sync() {\n        return _sync2.apply(this, arguments);\n      }\n\n      return _sync;\n    }()\n  }, {\n    key: \"_load\",\n    value: function () {\n      var _load2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee9(threeId) {\n        var _this2 = this;\n\n        var odbAddress, key, odbIdentity;\n        return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                this._3id = threeId || this._3id;\n                odbAddress = this._replicator.listStoreAddresses().find(function (odbAddress) {\n                  return odbAddress.includes(_this2._name);\n                });\n\n                if (!odbAddress) {\n                  _context9.next = 8;\n                  break;\n                }\n\n                _context9.next = 5;\n                return this._replicator.getStore(odbAddress);\n\n              case 5:\n                this._db = _context9.sent;\n                _context9.next = 14;\n                break;\n\n              case 8:\n                _context9.next = 10;\n                return this._3id.getPublicKeys(this._space, true);\n\n              case 10:\n                key = _context9.sent.signingKey;\n                _context9.next = 13;\n                return this._replicator.addKVStore(this._name, key, Boolean(this._space), this._3id.getSubDID(this._space));\n\n              case 13:\n                this._db = _context9.sent;\n\n              case 14:\n                _context9.next = 16;\n                return this._3id.getOdbId(this._space);\n\n              case 16:\n                odbIdentity = _context9.sent;\n\n                this._db.setIdentity(odbIdentity);\n\n                return _context9.abrupt(\"return\", this._db.address.toString());\n\n              case 19:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function _load(_x12) {\n        return _load2.apply(this, arguments);\n      }\n\n      return _load;\n    }()\n  }, {\n    key: \"_requireLoad\",\n    value: function _requireLoad() {\n      if (!this._db) throw new Error('_load must be called before interacting with the store');\n    }\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee10() {\n        return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                this._requireLoad();\n\n                _context10.next = 3;\n                return this._db.close();\n\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function close() {\n        return _close.apply(this, arguments);\n      }\n\n      return close;\n    }()\n    /**\n     * Get all values and optionally metadata\n     *\n     * @param     {Object}    opts                                    optional parameters\n     * @param     {Boolean}   opts.metadata                           return both values and metadata\n     * @return    {Array<String|{value: String, timestamp: Number}>}  the values\n     */\n\n  }, {\n    key: \"all\",\n    value: function () {\n      var _all = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee11() {\n        var _this3 = this;\n\n        var opts,\n            entries,\n            allSimple,\n            _args11 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                opts = _args11.length > 0 && _args11[0] !== undefined ? _args11[0] : {};\n\n                this._requireLoad();\n\n                entries = this._db.all;\n                allSimple = {};\n                Object.keys(entries).map(function (key) {\n                  var entry = entries[key];\n\n                  if (opts.metadata) {\n                    allSimple[key] = _objectSpread({}, _this3._extractMetadata(entry), {\n                      value: entry.value\n                    });\n                  } else {\n                    allSimple[key] = entry.value;\n                  }\n                });\n                return _context11.abrupt(\"return\", allSimple);\n\n              case 6:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function all() {\n        return _all.apply(this, arguments);\n      }\n\n      return all;\n    }()\n    /**\n     * Returns array of underlying log entries. In linearized order according to their Lamport clocks.\n     * Useful for generating a complete history of all operations on store.\n     *\n     *  @example\n     *  const log = store.log\n     *  const entry = log[0]\n     *  console.log(entry)\n     *  // { op: 'PUT', key: 'Name', value: 'Botbot', timeStamp: '1538575416068' }\n     *\n     * @return    {Array<Object>}     Array of ordered log entry objects\n     */\n\n  }, {\n    key: \"log\",\n    value: function () {\n      var _log = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee12() {\n        return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                return _context12.abrupt(\"return\", this._db._oplog.values.map(function (obj) {\n                  return {\n                    op: obj.payload.op,\n                    key: obj.payload.key,\n                    value: obj.payload.value ? obj.payload.value.value : null,\n                    timeStamp: obj.payload.value ? obj.payload.value.timeStamp : null\n                  };\n                }));\n\n              case 1:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function log() {\n        return _log.apply(this, arguments);\n      }\n\n      return log;\n    }()\n  }]);\n  return KeyValueStore;\n}();\n\nmodule.exports = KeyValueStore;"]},"metadata":{},"sourceType":"script"}