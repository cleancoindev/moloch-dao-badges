{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar KeyValueStore = require('./keyValueStore');\n\nvar Thread = require('./thread');\n\nvar GhostThread = require('./ghost');\n\nvar API = require('./api');\n\nvar _require = require('./utils'),\n    throwIfUndefined = _require.throwIfUndefined,\n    throwIfNotEqualLenArrays = _require.throwIfNotEqualLenArrays;\n\nvar OrbitDBAddress = require('orbit-db/src/orbit-db-address');\n\nvar resolveDID = require('did-resolver')[\"default\"];\n\nvar nameToSpaceName = function nameToSpaceName(name) {\n  return \"3box.space.\".concat(name, \".keyvalue\");\n};\n\nvar namesTothreadName = function namesTothreadName(spaceName, threadName) {\n  return \"3box.thread.\".concat(spaceName, \".\").concat(threadName);\n};\n\nvar namesToChatName = function namesToChatName(spaceName, chatName) {\n  return \"3box.ghost.\".concat(spaceName, \".\").concat(chatName);\n};\n\nvar findSpacePubKey = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(did, spaceName) {\n    var doc, pubkey;\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!did.startsWith('0x')) {\n              _context.next = 4;\n              break;\n            }\n\n            _context.next = 3;\n            return API.getSpaceDID(did, spaceName);\n\n          case 3:\n            did = _context.sent;\n\n          case 4:\n            _context.next = 6;\n            return resolveDID(did);\n\n          case 6:\n            doc = _context.sent;\n            pubkey = doc.publicKey.find(function (key) {\n              return key.id.includes('#subEncryptionKey');\n            });\n\n            if (pubkey) {\n              _context.next = 16;\n              break;\n            }\n\n            _context.next = 11;\n            return API.getSpaceDID(did, spaceName);\n\n          case 11:\n            did = _context.sent;\n            _context.next = 14;\n            return resolveDID(did);\n\n          case 14:\n            doc = _context.sent;\n            pubkey = doc.publicKey.find(function (key) {\n              return key.id.includes('#subEncryptionKey');\n            });\n\n          case 16:\n            return _context.abrupt(\"return\", pubkey.publicKeyBase64);\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function findSpacePubKey(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n/** Class representing a user. */\n\n\nvar User = /*#__PURE__*/function () {\n  function User(spaceName, threeId) {\n    (0, _classCallCheck2[\"default\"])(this, User);\n    this._name = spaceName;\n    this._3id = threeId;\n  }\n  /**\n   * @property {String} DID            the DID of the user\n   */\n\n\n  (0, _createClass2[\"default\"])(User, [{\n    key: \"signClaim\",\n\n    /**\n     * Sign a JWT claim\n     *\n     * @param     {Object}    payload                 The payload to sign\n     * @param     {Object}    opts                    Optional parameters\n     *\n     * @return    {String}                            The signed JWT\n     */\n    value: function () {\n      var _signClaim = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(payload) {\n        var opts,\n            _args2 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                opts = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : {};\n                return _context2.abrupt(\"return\", this._3id.signJWT(payload, Object.assign(opts, {\n                  space: this._name\n                })));\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signClaim(_x3) {\n        return _signClaim.apply(this, arguments);\n      }\n\n      return signClaim;\n    }()\n    /**\n     * Encrypt a message. By default encrypts messages symmetrically\n     * with the users private key. If the `to` parameter is used,\n     * the message will be asymmetrically encrypted to the recipient.\n     *\n     * @param     {String}    message                 The message to encrypt\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {String}    to                      The receiver of the message, a DID or an ethereum address\n     *\n     * @return    {Object}                            An object containing the encrypted payload\n     */\n\n  }, {\n    key: \"encrypt\",\n    value: function () {\n      var _encrypt = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(message) {\n        var _ref2,\n            to,\n            toPubkey,\n            _args3 = arguments;\n\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref2 = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {}, to = _ref2.to;\n\n                if (!to) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 4;\n                return findSpacePubKey(to, this._name);\n\n              case 4:\n                toPubkey = _context3.sent;\n\n              case 5:\n                return _context3.abrupt(\"return\", this._3id.encrypt(message, this._name, toPubkey));\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function encrypt(_x4) {\n        return _encrypt.apply(this, arguments);\n      }\n\n      return encrypt;\n    }()\n    /**\n     * Decrypts a message if the user owns the correct key to decrypt it.\n     *\n     * @param     {Object}    encryptedObject         The encrypted message to decrypt (as encoded by the `encrypt` method\n     *\n     * @return    {String}                            The clear text message\n     */\n\n  }, {\n    key: \"decrypt\",\n    value: function () {\n      var _decrypt = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(encryptedObject, toBuffer) {\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this._3id.decrypt(encryptedObject, this._name, toBuffer));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function decrypt(_x5, _x6) {\n        return _decrypt.apply(this, arguments);\n      }\n\n      return decrypt;\n    }()\n  }, {\n    key: \"DID\",\n    get: function get() {\n      return this._3id.getSubDID(this._name);\n    }\n  }]);\n  return User;\n}();\n\nvar Space = /*#__PURE__*/function () {\n  /**\n   * Please use **box.openSpace** to get the instance of this class\n   */\n  function Space(name, replicator) {\n    (0, _classCallCheck2[\"default\"])(this, Space);\n    this._name = name;\n    this._replicator = replicator;\n    this._store = new KeyValueStore(nameToSpaceName(this._name), this._replicator);\n    this._activeThreads = {};\n    /**\n     * @property {KeyValueStore} public         access the profile store of the space\n     */\n\n    this[\"public\"] = null;\n    /**\n     * @property {KeyValueStore} private        access the private store of the space\n     */\n\n    this[\"private\"] = null;\n    /**\n     * @property {Promise}       syncDone       A promise that is resolved when the space data is synced\n     */\n\n    this.syncDone = null;\n  }\n\n  (0, _createClass2[\"default\"])(Space, [{\n    key: \"open\",\n    value: function () {\n      var _open = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(threeId) {\n        var _this = this;\n\n        var opts,\n            authenticated,\n            syncSpace,\n            _args6 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                opts = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : {};\n\n                if (this.isOpen) {\n                  _context6.next = 18;\n                  break;\n                } // store is not loaded opened yet\n\n\n                this._3id = threeId;\n                _context6.next = 5;\n                return this._3id.isAuthenticated([this._name]);\n\n              case 5:\n                authenticated = _context6.sent;\n\n                if (authenticated) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                _context6.next = 9;\n                return this._3id.authenticate([this._name]);\n\n              case 9:\n                if (opts.consentCallback) opts.consentCallback(!authenticated, this._name);\n                _context6.next = 12;\n                return this._store._load(this._3id);\n\n              case 12:\n                syncSpace = /*#__PURE__*/function () {\n                  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5() {\n                    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            _context5.next = 2;\n                            return _this._store._sync();\n\n                          case 2:\n                            if (opts.onSyncDone) opts.onSyncDone();\n\n                          case 3:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n\n                  return function syncSpace() {\n                    return _ref3.apply(this, arguments);\n                  };\n                }();\n\n                this.syncDone = syncSpace();\n                this[\"public\"] = publicStoreReducer(this._store);\n                this[\"private\"] = privateStoreReducer(this._store, this._3id, this._name); // make sure we're authenticated to all threads\n\n                _context6.next = 18;\n                return this._authThreads(this._3id);\n\n              case 18:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function open(_x7) {\n        return _open.apply(this, arguments);\n      }\n\n      return open;\n    }()\n  }, {\n    key: \"_authThreads\",\n    value: function () {\n      var _authThreads2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(threeId) {\n        var odbIdentity;\n        return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return threeId.getOdbId(this._name);\n\n              case 2:\n                odbIdentity = _context7.sent;\n                Object.values(this._activeThreads).forEach(function (thread) {\n                  if (thread.isGhost) {\n                    thread._set3id(threeId);\n                  } else {\n                    thread._setIdentity(odbIdentity);\n                  }\n                });\n\n              case 4:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _authThreads(_x8) {\n        return _authThreads2.apply(this, arguments);\n      }\n\n      return _authThreads;\n    }()\n    /**\n     * Join a thread. Use this to start receiving updates from, and to post in threads\n     *\n     * @param     {String}    name                    The name of the thread\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {String}    opts.firstModerator     DID of first moderator of a thread, by default, user is first moderator\n     * @param     {Boolean}   opts.members            join a members only thread, which only members can post in, defaults to open thread\n     * @param     {Boolean}   opts.confidential       create a confidential thread with true or join existing confidential thread with an encKeyId string\n     * @param     {Boolean}   opts.noAutoSub          Disable auto subscription to the thread when posting to it (default false)\n     * @param     {Boolean}   opts.ghost              Enable ephemeral messaging via Ghost Thread\n     * @param     {Number}    opts.ghostBacklogLimit  The number of posts to maintain in the ghost backlog\n     * @param     {Array<Function>} opts.ghostFilters Array of functions for filtering messages\n     *\n     * @return    {Thread}                  An instance of the thread class for the joined thread\n     */\n\n  }, {\n    key: \"joinThread\",\n    value: function () {\n      var _joinThread = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8(name) {\n        var opts,\n            ghostAddress,\n            subscribeFn,\n            user,\n            thread,\n            address,\n            _args8 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                opts = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {};\n\n                if (!opts.ghost) {\n                  _context8.next = 8;\n                  break;\n                }\n\n                ghostAddress = namesToChatName(this._name, name);\n\n                if (!this._activeThreads[ghostAddress]) {\n                  this._activeThreads[ghostAddress] = new GhostThread(ghostAddress, this._replicator, this._3id, opts);\n                }\n\n                if (this._3id) {\n                  this._activeThreads[ghostAddress]._set3id(this._3id);\n                }\n\n                return _context8.abrupt(\"return\", this._activeThreads[ghostAddress]);\n\n              case 8:\n                subscribeFn = opts.noAutoSub ? function () {} : this.subscribeThread.bind(this);\n\n                if (!opts.confidential) {\n                  _context8.next = 12;\n                  break;\n                }\n\n                if (this._3id) {\n                  _context8.next = 12;\n                  break;\n                }\n\n                throw new Error('confidential threads require user to be authenticated');\n\n              case 12:\n                if (opts.firstModerator) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                if (this._3id) {\n                  _context8.next = 15;\n                  break;\n                }\n\n                throw new Error('firstModerator required if not authenticated');\n\n              case 15:\n                opts.firstModerator = this._3id.getSubDID(this._name);\n\n              case 16:\n                user = this._3id ? this.user : {};\n                thread = new Thread(namesTothreadName(this._name, name), this._replicator, opts.members, opts.firstModerator, opts.confidential, user, subscribeFn);\n                _context8.next = 20;\n                return thread._getThreadAddress();\n\n              case 20:\n                address = _context8.sent;\n\n                if (!this._activeThreads[address]) {\n                  _context8.next = 23;\n                  break;\n                }\n\n                return _context8.abrupt(\"return\", this._activeThreads[address]);\n\n              case 23:\n                _context8.next = 25;\n                return thread._load();\n\n              case 25:\n                if (!this._3id) {\n                  _context8.next = 32;\n                  break;\n                }\n\n                _context8.t0 = thread;\n                _context8.next = 29;\n                return this._3id.getOdbId(this._name);\n\n              case 29:\n                _context8.t1 = _context8.sent;\n                _context8.next = 32;\n                return _context8.t0._setIdentity.call(_context8.t0, _context8.t1);\n\n              case 32:\n                this._activeThreads[address] = thread;\n                return _context8.abrupt(\"return\", thread);\n\n              case 34:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function joinThread(_x9) {\n        return _joinThread.apply(this, arguments);\n      }\n\n      return joinThread;\n    }()\n    /**\n     * Create a confidential thread\n     *\n     * @param     {String}    name          The name of the thread\n     *\n     * @return    {Thread}                  An instance of the thread class for the created thread\n     */\n\n  }, {\n    key: \"createConfidentialThread\",\n    value: function () {\n      var _createConfidentialThread = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(name) {\n        return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                return _context9.abrupt(\"return\", this.joinThread(name, {\n                  confidential: true\n                }));\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function createConfidentialThread(_x10) {\n        return _createConfidentialThread.apply(this, arguments);\n      }\n\n      return createConfidentialThread;\n    }()\n    /**\n     * Join a thread by full thread address. Use this to start receiving updates from, and to post in threads\n     *\n     * @param     {String}    address                 The full address of the thread\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {Boolean}   opts.noAutoSub          Disable auto subscription to the thread when posting to it (default false)\n     *\n     * @return    {Thread}                            An instance of the thread class for the joined thread\n     */\n\n  }, {\n    key: \"joinThreadByAddress\",\n    value: function () {\n      var _joinThreadByAddress = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee10(address) {\n        var opts,\n            threadSpace,\n            threadName,\n            subscribeFn,\n            user,\n            thread,\n            _args10 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                opts = _args10.length > 1 && _args10[1] !== undefined ? _args10[1] : {};\n\n                if (OrbitDBAddress.isValid(address)) {\n                  _context10.next = 3;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress: valid orbitdb address required');\n\n              case 3:\n                if (this.isOpen) {\n                  _context10.next = 5;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress requires space to be open');\n\n              case 5:\n                threadSpace = address.split('.')[2];\n                threadName = address.split('.')[3];\n\n                if (!(threadSpace !== this._name)) {\n                  _context10.next = 9;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress: attempting to open thread from different space, must open within same space');\n\n              case 9:\n                if (!this._activeThreads[address]) {\n                  _context10.next = 11;\n                  break;\n                }\n\n                return _context10.abrupt(\"return\", this._activeThreads[address]);\n\n              case 11:\n                subscribeFn = opts.noAutoSub ? function () {} : this.subscribeThread.bind(this);\n                user = this._3id ? this.user : {};\n                thread = new Thread(namesTothreadName(this._name, threadName), this._replicator, undefined, undefined, undefined, user, subscribeFn);\n                _context10.next = 16;\n                return thread._load(address);\n\n              case 16:\n                if (!this._3id) {\n                  _context10.next = 23;\n                  break;\n                }\n\n                _context10.t0 = thread;\n                _context10.next = 20;\n                return this._3id.getOdbId(this._name);\n\n              case 20:\n                _context10.t1 = _context10.sent;\n                _context10.next = 23;\n                return _context10.t0._setIdentity.call(_context10.t0, _context10.t1);\n\n              case 23:\n                this._activeThreads[address] = thread;\n                return _context10.abrupt(\"return\", thread);\n\n              case 25:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function joinThreadByAddress(_x11) {\n        return _joinThreadByAddress.apply(this, arguments);\n      }\n\n      return joinThreadByAddress;\n    }()\n    /**\n     * Subscribe to the given thread, if not already subscribed\n     *\n     * @param     {String}    address                The address of the thread\n     * @param     {Object}    config                configuration and thread meta data\n     * @param     {String}    opts.name             Name of thread\n     * @param     {String}    opts.firstModerator   DID of the first moderator\n     * @param     {String}    opts.members          Boolean string, true if a members only thread\n     */\n\n  }, {\n    key: \"subscribeThread\",\n    value: function () {\n      var _subscribeThread = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee11(address) {\n        var config,\n            threadKey,\n            _args11 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                config = _args11.length > 1 && _args11[1] !== undefined ? _args11[1] : {};\n\n                if (OrbitDBAddress.isValid(address)) {\n                  _context11.next = 3;\n                  break;\n                }\n\n                throw new Error('subscribeThread: must subscribe to valid thread/orbitdb address');\n\n              case 3:\n                if (this.isOpen) {\n                  _context11.next = 5;\n                  break;\n                }\n\n                return _context11.abrupt(\"return\");\n\n              case 5:\n                // we can't subscribe if space isn't open\n                threadKey = \"thread-\".concat(address);\n                _context11.next = 8;\n                return this.syncDone;\n\n              case 8:\n                _context11.next = 10;\n                return this[\"public\"].get(threadKey);\n\n              case 10:\n                if (_context11.sent) {\n                  _context11.next = 13;\n                  break;\n                }\n\n                _context11.next = 13;\n                return this[\"public\"].set(threadKey, Object.assign({}, config, {\n                  address: address\n                }));\n\n              case 13:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function subscribeThread(_x12) {\n        return _subscribeThread.apply(this, arguments);\n      }\n\n      return subscribeThread;\n    }()\n    /**\n     * Unsubscribe from the given thread, if subscribed\n     *\n     * @param     {String}    address     The address of the thread\n     */\n\n  }, {\n    key: \"unsubscribeThread\",\n    value: function () {\n      var _unsubscribeThread = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee12(address) {\n        var threadKey;\n        return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (this.isOpen) {\n                  _context12.next = 2;\n                  break;\n                }\n\n                throw new Error('unsubscribeThread requires space to be open');\n\n              case 2:\n                threadKey = \"thread-\".concat(address);\n                _context12.next = 5;\n                return this[\"public\"].get(threadKey);\n\n              case 5:\n                if (!_context12.sent) {\n                  _context12.next = 8;\n                  break;\n                }\n\n                _context12.next = 8;\n                return this[\"public\"].remove(threadKey);\n\n              case 8:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function unsubscribeThread(_x13) {\n        return _unsubscribeThread.apply(this, arguments);\n      }\n\n      return unsubscribeThread;\n    }()\n    /**\n     * Get a list of all the threads subscribed to in this space\n     *\n     * @return    {Array<Objects>}    A list of thread objects as { address, firstModerator, members, name}\n     */\n\n  }, {\n    key: \"subscribedThreads\",\n    value: function () {\n      var _subscribedThreads = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee13() {\n        var allEntries;\n        return _regenerator[\"default\"].wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                if (this.isOpen) {\n                  _context13.next = 2;\n                  break;\n                }\n\n                throw new Error('subscribedThreads requires space to be open');\n\n              case 2:\n                _context13.next = 4;\n                return this[\"public\"].all();\n\n              case 4:\n                allEntries = _context13.sent;\n                return _context13.abrupt(\"return\", Object.keys(allEntries).reduce(function (threads, key) {\n                  if (key.startsWith('thread')) {\n                    // ignores experimental threads (v1)\n                    var address = key.split('thread-')[1];\n\n                    if (OrbitDBAddress.isValid(address)) {\n                      threads.push(allEntries[key]);\n                    }\n                  }\n\n                  return threads;\n                }, []));\n\n              case 6:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function subscribedThreads() {\n        return _subscribedThreads.apply(this, arguments);\n      }\n\n      return subscribedThreads;\n    }()\n  }, {\n    key: \"DID\",\n    get: function get() {\n      return this.user.DID;\n    }\n    /**\n     * @property {User} user            access the user object to encrypt data and sign claims\n     */\n\n  }, {\n    key: \"user\",\n    get: function get() {\n      if (!this._3id) throw new Error('user is not authenticated');\n      this._user = this._user || new User(this._name, this._3id);\n      return this._user;\n    }\n  }, {\n    key: \"isOpen\",\n    get: function get() {\n      return Boolean(this._store._db);\n    }\n  }]);\n  return Space;\n}();\n\nmodule.exports = Space;\n\nvar publicStoreReducer = function publicStoreReducer(store) {\n  var PREFIX = 'pub_';\n  return {\n    get: function () {\n      var _get = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee14(key) {\n        var opts,\n            _args14 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                opts = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : {};\n                return _context14.abrupt(\"return\", store.get(PREFIX + key, opts));\n\n              case 2:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n\n      function get(_x14) {\n        return _get.apply(this, arguments);\n      }\n\n      return get;\n    }(),\n    getMetadata: function () {\n      var _getMetadata = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee15(key) {\n        return _regenerator[\"default\"].wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                return _context15.abrupt(\"return\", store.getMetadata(PREFIX + key));\n\n              case 1:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n\n      function getMetadata(_x15) {\n        return _getMetadata.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }(),\n    set: function () {\n      var _set = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee16(key, value) {\n        return _regenerator[\"default\"].wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n                return _context16.abrupt(\"return\", store.set(PREFIX + key, value));\n\n              case 2:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16);\n      }));\n\n      function set(_x16, _x17) {\n        return _set.apply(this, arguments);\n      }\n\n      return set;\n    }(),\n    setMultiple: function () {\n      var _setMultiple = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee17(keys, values) {\n        var prefixedKeys;\n        return _regenerator[\"default\"].wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n                prefixedKeys = keys.map(function (key) {\n                  return PREFIX + key;\n                });\n                return _context17.abrupt(\"return\", store.setMultiple(prefixedKeys, values));\n\n              case 3:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17);\n      }));\n\n      function setMultiple(_x18, _x19) {\n        return _setMultiple.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }(),\n    remove: function () {\n      var _remove = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee18(key) {\n        return _regenerator[\"default\"].wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n                return _context18.abrupt(\"return\", store.remove(PREFIX + key));\n\n              case 2:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18);\n      }));\n\n      function remove(_x20) {\n        return _remove.apply(this, arguments);\n      }\n\n      return remove;\n    }(),\n    log: function () {\n      var _log = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee19() {\n        return _regenerator[\"default\"].wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return store.log();\n\n              case 2:\n                _context19.t0 = function (newLog, entry) {\n                  if (entry.key.startsWith(PREFIX)) {\n                    entry.key = entry.key.slice(4);\n                    newLog.push(entry);\n                  }\n\n                  return newLog;\n                };\n\n                _context19.t1 = [];\n                return _context19.abrupt(\"return\", _context19.sent.reduce(_context19.t0, _context19.t1));\n\n              case 5:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n\n      function log() {\n        return _log.apply(this, arguments);\n      }\n\n      return log;\n    }(),\n    all: function () {\n      var _all = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee20(opts) {\n        var entries;\n        return _regenerator[\"default\"].wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return store.all(opts);\n\n              case 2:\n                entries = _context20.sent;\n                return _context20.abrupt(\"return\", Object.keys(entries).reduce(function (newAll, key) {\n                  if (key.startsWith(PREFIX)) {\n                    newAll[key.slice(4)] = entries[key];\n                  }\n\n                  return newAll;\n                }, {}));\n\n              case 4:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n\n      function all(_x21) {\n        return _all.apply(this, arguments);\n      }\n\n      return all;\n    }()\n  };\n};\n\nvar privateStoreReducer = function privateStoreReducer(store, threeId, spaceName) {\n  var PREFIX = 'priv_';\n\n  var dbKey = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee21(key) {\n      return _regenerator[\"default\"].wrap(function _callee21$(_context21) {\n        while (1) {\n          switch (_context21.prev = _context21.next) {\n            case 0:\n              throwIfUndefined(key, 'key');\n              _context21.t0 = PREFIX;\n              _context21.next = 4;\n              return threeId.hashDBKey(key, spaceName);\n\n            case 4:\n              _context21.t1 = _context21.sent;\n              return _context21.abrupt(\"return\", _context21.t0 + _context21.t1);\n\n            case 6:\n            case \"end\":\n              return _context21.stop();\n          }\n        }\n      }, _callee21);\n    }));\n\n    return function dbKey(_x22) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var encryptEntry = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee22(entry) {\n      return _regenerator[\"default\"].wrap(function _callee22$(_context22) {\n        while (1) {\n          switch (_context22.prev = _context22.next) {\n            case 0:\n              return _context22.abrupt(\"return\", threeId.encrypt(JSON.stringify(entry), spaceName));\n\n            case 1:\n            case \"end\":\n              return _context22.stop();\n          }\n        }\n      }, _callee22);\n    }));\n\n    return function encryptEntry(_x23) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var decryptEntry = /*#__PURE__*/function () {\n    var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee23(encObj) {\n      return _regenerator[\"default\"].wrap(function _callee23$(_context23) {\n        while (1) {\n          switch (_context23.prev = _context23.next) {\n            case 0:\n              _context23.t0 = JSON;\n              _context23.next = 3;\n              return threeId.decrypt(encObj, spaceName);\n\n            case 3:\n              _context23.t1 = _context23.sent;\n              return _context23.abrupt(\"return\", _context23.t0.parse.call(_context23.t0, _context23.t1));\n\n            case 5:\n            case \"end\":\n              return _context23.stop();\n          }\n        }\n      }, _callee23);\n    }));\n\n    return function decryptEntry(_x24) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  return {\n    get: function () {\n      var _get2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee24(key) {\n        var opts,\n            entry,\n            _args24 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                opts = _args24.length > 1 && _args24[1] !== undefined ? _args24[1] : {};\n                _context24.t0 = store;\n                _context24.next = 4;\n                return dbKey(key);\n\n              case 4:\n                _context24.t1 = _context24.sent;\n                _context24.t2 = opts;\n                _context24.next = 8;\n                return _context24.t0.get.call(_context24.t0, _context24.t1, _context24.t2);\n\n              case 8:\n                entry = _context24.sent;\n\n                if (entry) {\n                  _context24.next = 11;\n                  break;\n                }\n\n                return _context24.abrupt(\"return\", null);\n\n              case 11:\n                if (!opts.metadata) {\n                  _context24.next = 20;\n                  break;\n                }\n\n                _context24.t3 = _objectSpread;\n                _context24.t4 = {};\n                _context24.t5 = entry;\n                _context24.next = 17;\n                return decryptEntry(entry.value);\n\n              case 17:\n                _context24.t6 = _context24.sent.value;\n                _context24.t7 = {\n                  value: _context24.t6\n                };\n                return _context24.abrupt(\"return\", (0, _context24.t3)(_context24.t4, _context24.t5, _context24.t7));\n\n              case 20:\n                _context24.next = 22;\n                return decryptEntry(entry);\n\n              case 22:\n                return _context24.abrupt(\"return\", _context24.sent.value);\n\n              case 23:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24);\n      }));\n\n      function get(_x25) {\n        return _get2.apply(this, arguments);\n      }\n\n      return get;\n    }(),\n    getMetadata: function () {\n      var _getMetadata2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee25(key) {\n        return _regenerator[\"default\"].wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                _context25.t0 = store;\n                _context25.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context25.t1 = _context25.sent;\n                return _context25.abrupt(\"return\", _context25.t0.getMetadata.call(_context25.t0, _context25.t1));\n\n              case 5:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25);\n      }));\n\n      function getMetadata(_x26) {\n        return _getMetadata2.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }(),\n    set: function () {\n      var _set2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee26(key, value) {\n        return _regenerator[\"default\"].wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.t0 = store;\n                _context26.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context26.t1 = _context26.sent;\n                _context26.next = 6;\n                return encryptEntry({\n                  key: key,\n                  value: value\n                });\n\n              case 6:\n                _context26.t2 = _context26.sent;\n                return _context26.abrupt(\"return\", _context26.t0.set.call(_context26.t0, _context26.t1, _context26.t2));\n\n              case 8:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26);\n      }));\n\n      function set(_x27, _x28) {\n        return _set2.apply(this, arguments);\n      }\n\n      return set;\n    }(),\n    setMultiple: function () {\n      var _setMultiple2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee27(keys, values) {\n        var dbKeys, encryptedEntries;\n        return _regenerator[\"default\"].wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n                _context27.next = 3;\n                return Promise.all(keys.map(dbKey));\n\n              case 3:\n                dbKeys = _context27.sent;\n                _context27.next = 6;\n                return Promise.all(values.map(function (value, index) {\n                  return encryptEntry({\n                    key: keys[index],\n                    value: value\n                  });\n                }));\n\n              case 6:\n                encryptedEntries = _context27.sent;\n                return _context27.abrupt(\"return\", store.setMultiple(dbKeys, encryptedEntries));\n\n              case 8:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27);\n      }));\n\n      function setMultiple(_x29, _x30) {\n        return _setMultiple2.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }(),\n    remove: function () {\n      var _remove2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee28(key) {\n        return _regenerator[\"default\"].wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _context28.t0 = store;\n                _context28.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context28.t1 = _context28.sent;\n                return _context28.abrupt(\"return\", _context28.t0.remove.call(_context28.t0, _context28.t1));\n\n              case 5:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28);\n      }));\n\n      function remove(_x31) {\n        return _remove2.apply(this, arguments);\n      }\n\n      return remove;\n    }(),\n    log: function () {\n      var _log2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee29() {\n        var log, privLog, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, entry, decEntry;\n\n        return _regenerator[\"default\"].wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                _context29.next = 2;\n                return store.log();\n\n              case 2:\n                log = _context29.sent;\n                privLog = [];\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context29.prev = 7;\n                _iterator = log[Symbol.iterator]();\n\n              case 9:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context29.next = 21;\n                  break;\n                }\n\n                entry = _step.value;\n\n                if (!entry.key.startsWith(PREFIX)) {\n                  _context29.next = 18;\n                  break;\n                }\n\n                _context29.next = 14;\n                return decryptEntry(entry.value);\n\n              case 14:\n                decEntry = _context29.sent;\n                entry.key = decEntry.key;\n                entry.value = decEntry.value;\n                privLog.push(entry);\n\n              case 18:\n                _iteratorNormalCompletion = true;\n                _context29.next = 9;\n                break;\n\n              case 21:\n                _context29.next = 27;\n                break;\n\n              case 23:\n                _context29.prev = 23;\n                _context29.t0 = _context29[\"catch\"](7);\n                _didIteratorError = true;\n                _iteratorError = _context29.t0;\n\n              case 27:\n                _context29.prev = 27;\n                _context29.prev = 28;\n\n                if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n                  _iterator[\"return\"]();\n                }\n\n              case 30:\n                _context29.prev = 30;\n\n                if (!_didIteratorError) {\n                  _context29.next = 33;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 33:\n                return _context29.finish(30);\n\n              case 34:\n                return _context29.finish(27);\n\n              case 35:\n                return _context29.abrupt(\"return\", privLog);\n\n              case 36:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, null, [[7, 23, 27, 35], [28,, 30, 34]]);\n      }));\n\n      function log() {\n        return _log2.apply(this, arguments);\n      }\n\n      return log;\n    }(),\n    all: function () {\n      var _all2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee30() {\n        var opts,\n            entries,\n            privEntries,\n            key,\n            entry,\n            decEntry,\n            _decEntry,\n            _args30 = arguments;\n\n        return _regenerator[\"default\"].wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                opts = _args30.length > 0 && _args30[0] !== undefined ? _args30[0] : {};\n                _context30.next = 3;\n                return store.all(opts);\n\n              case 3:\n                entries = _context30.sent;\n                privEntries = {};\n                _context30.t0 = _regenerator[\"default\"].keys(entries);\n\n              case 6:\n                if ((_context30.t1 = _context30.t0()).done) {\n                  _context30.next = 23;\n                  break;\n                }\n\n                key = _context30.t1.value;\n\n                if (!key.startsWith(PREFIX)) {\n                  _context30.next = 21;\n                  break;\n                }\n\n                entry = entries[key];\n\n                if (!opts.metadata) {\n                  _context30.next = 17;\n                  break;\n                }\n\n                _context30.next = 13;\n                return decryptEntry(entry.value);\n\n              case 13:\n                decEntry = _context30.sent;\n                privEntries[decEntry.key] = _objectSpread({}, entry, {\n                  value: decEntry.value\n                });\n                _context30.next = 21;\n                break;\n\n              case 17:\n                _context30.next = 19;\n                return decryptEntry(entry);\n\n              case 19:\n                _decEntry = _context30.sent;\n                privEntries[_decEntry.key] = _decEntry.value;\n\n              case 21:\n                _context30.next = 6;\n                break;\n\n              case 23:\n                return _context30.abrupt(\"return\", privEntries);\n\n              case 24:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30);\n      }));\n\n      function all() {\n        return _all2.apply(this, arguments);\n      }\n\n      return all;\n    }()\n  };\n};","map":{"version":3,"sources":["/home/samkuhlmann/Documents/ody/moloch/moloch-dao-badges/node_modules/3box/lib/space.js"],"names":["_interopRequireDefault","require","_defineProperty2","_classCallCheck2","_createClass2","_regenerator","_asyncToGenerator2","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","KeyValueStore","Thread","GhostThread","API","_require","throwIfUndefined","throwIfNotEqualLenArrays","OrbitDBAddress","resolveDID","nameToSpaceName","name","concat","namesTothreadName","spaceName","threadName","namesToChatName","chatName","findSpacePubKey","_ref","mark","_callee","did","doc","pubkey","wrap","_callee$","_context","prev","next","startsWith","getSpaceDID","sent","publicKey","find","id","includes","abrupt","publicKeyBase64","stop","_x","_x2","User","threeId","_name","_3id","value","_signClaim","_callee2","payload","opts","_args2","_callee2$","_context2","undefined","signJWT","assign","space","signClaim","_x3","_encrypt","_callee3","message","_ref2","to","toPubkey","_args3","_callee3$","_context3","encrypt","_x4","_decrypt","_callee4","encryptedObject","toBuffer","_callee4$","_context4","decrypt","_x5","_x6","get","getSubDID","Space","replicator","_replicator","_store","_activeThreads","syncDone","_open","_callee6","_this","authenticated","syncSpace","_args6","_callee6$","_context6","isOpen","isAuthenticated","authenticate","consentCallback","_load","_ref3","_callee5","_callee5$","_context5","_sync","onSyncDone","publicStoreReducer","privateStoreReducer","_authThreads","open","_x7","_authThreads2","_callee7","odbIdentity","_callee7$","_context7","getOdbId","values","thread","isGhost","_set3id","_setIdentity","_x8","_joinThread","_callee8","ghostAddress","subscribeFn","user","address","_args8","_callee8$","_context8","ghost","noAutoSub","subscribeThread","bind","confidential","Error","firstModerator","members","_getThreadAddress","t0","t1","call","joinThread","_x9","_createConfidentialThread","_callee9","_callee9$","_context9","createConfidentialThread","_x10","_joinThreadByAddress","_callee10","threadSpace","_args10","_callee10$","_context10","isValid","split","joinThreadByAddress","_x11","_subscribeThread","_callee11","config","threadKey","_args11","_callee11$","_context11","set","_x12","_unsubscribeThread","_callee12","_callee12$","_context12","remove","unsubscribeThread","_x13","_subscribedThreads","_callee13","allEntries","_callee13$","_context13","all","reduce","threads","subscribedThreads","DID","_user","Boolean","_db","module","exports","store","PREFIX","_get","_callee14","_args14","_callee14$","_context14","_x14","getMetadata","_getMetadata","_callee15","_callee15$","_context15","_x15","_set","_callee16","_callee16$","_context16","_x16","_x17","setMultiple","_setMultiple","_callee17","prefixedKeys","_callee17$","_context17","map","_x18","_x19","_remove","_callee18","_callee18$","_context18","_x20","log","_log","_callee19","_callee19$","_context19","newLog","entry","slice","_all","_callee20","entries","_callee20$","_context20","newAll","_x21","dbKey","_ref4","_callee21","_callee21$","_context21","hashDBKey","_x22","encryptEntry","_ref5","_callee22","_callee22$","_context22","JSON","stringify","_x23","decryptEntry","_ref6","_callee23","encObj","_callee23$","_context23","parse","_x24","_get2","_callee24","_args24","_callee24$","_context24","t2","metadata","t3","t4","t5","t6","t7","_x25","_getMetadata2","_callee25","_callee25$","_context25","_x26","_set2","_callee26","_callee26$","_context26","_x27","_x28","_setMultiple2","_callee27","dbKeys","encryptedEntries","_callee27$","_context27","Promise","index","_x29","_x30","_remove2","_callee28","_callee28$","_context28","_x31","_log2","_callee29","privLog","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","decEntry","_callee29$","_context29","Symbol","iterator","done","finish","_all2","_callee30","privEntries","_decEntry","_args30","_callee30$","_context30"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEA,IAAIC,gBAAgB,GAAGF,sBAAsB,CAACC,OAAO,CAAC,uCAAD,CAAR,CAA7C;;AAEA,IAAIE,gBAAgB,GAAGH,sBAAsB,CAACC,OAAO,CAAC,uCAAD,CAAR,CAA7C;;AAEA,IAAIG,aAAa,GAAGJ,sBAAsB,CAACC,OAAO,CAAC,oCAAD,CAAR,CAA1C;;AAEA,IAAII,YAAY,GAAGL,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAAzC;;AAEA,IAAIK,kBAAkB,GAAGN,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAA/C;;AAEA,SAASM,OAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;AAAE,MAAIC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYF,MAAZ,CAAX;;AAAgC,MAAIG,MAAM,CAACC,qBAAX,EAAkC;AAAE,QAAIC,OAAO,GAAGF,MAAM,CAACC,qBAAP,CAA6BJ,MAA7B,CAAd;AAAoD,QAAIC,cAAJ,EAAoBI,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe;AAAE,aAAOJ,MAAM,CAACK,wBAAP,CAAgCR,MAAhC,EAAwCO,GAAxC,EAA6CE,UAApD;AAAiE,KAAjG,CAAV;AAA8GP,IAAAA,IAAI,CAACQ,IAAL,CAAUC,KAAV,CAAgBT,IAAhB,EAAsBG,OAAtB;AAAiC;;AAAC,SAAOH,IAAP;AAAc;;AAErV,SAASU,aAAT,CAAuBC,MAAvB,EAA+B;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAT,IAAgB,IAAhB,GAAuBC,SAAS,CAACD,CAAD,CAAhC,GAAsC,EAAnD;;AAAuD,QAAIA,CAAC,GAAG,CAAR,EAAW;AAAEf,MAAAA,OAAO,CAACkB,MAAD,EAAS,IAAT,CAAP,CAAsBC,OAAtB,CAA8B,UAAUC,GAAV,EAAe;AAAE,SAAC,GAAGzB,gBAAgB,CAAC,SAAD,CAApB,EAAiCmB,MAAjC,EAAyCM,GAAzC,EAA8CF,MAAM,CAACE,GAAD,CAApD;AAA6D,OAA5G;AAAgH,KAA7H,MAAmI,IAAIhB,MAAM,CAACiB,yBAAX,EAAsC;AAAEjB,MAAAA,MAAM,CAACkB,gBAAP,CAAwBR,MAAxB,EAAgCV,MAAM,CAACiB,yBAAP,CAAiCH,MAAjC,CAAhC;AAA4E,KAApH,MAA0H;AAAElB,MAAAA,OAAO,CAACkB,MAAD,CAAP,CAAgBC,OAAhB,CAAwB,UAAUC,GAAV,EAAe;AAAEhB,QAAAA,MAAM,CAACmB,cAAP,CAAsBT,MAAtB,EAA8BM,GAA9B,EAAmChB,MAAM,CAACK,wBAAP,CAAgCS,MAAhC,EAAwCE,GAAxC,CAAnC;AAAmF,OAA5H;AAAgI;AAAE;;AAAC,SAAON,MAAP;AAAgB;;AAEvhB,IAAIU,aAAa,GAAG9B,OAAO,CAAC,iBAAD,CAA3B;;AAEA,IAAI+B,MAAM,GAAG/B,OAAO,CAAC,UAAD,CAApB;;AAEA,IAAIgC,WAAW,GAAGhC,OAAO,CAAC,SAAD,CAAzB;;AAEA,IAAIiC,GAAG,GAAGjC,OAAO,CAAC,OAAD,CAAjB;;AAEA,IAAIkC,QAAQ,GAAGlC,OAAO,CAAC,SAAD,CAAtB;AAAA,IACImC,gBAAgB,GAAGD,QAAQ,CAACC,gBADhC;AAAA,IAEIC,wBAAwB,GAAGF,QAAQ,CAACE,wBAFxC;;AAIA,IAAIC,cAAc,GAAGrC,OAAO,CAAC,+BAAD,CAA5B;;AAEA,IAAIsC,UAAU,GAAGtC,OAAO,CAAC,cAAD,CAAP,CAAwB,SAAxB,CAAjB;;AAEA,IAAIuC,eAAe,GAAG,SAASA,eAAT,CAAyBC,IAAzB,EAA+B;AACnD,SAAO,cAAcC,MAAd,CAAqBD,IAArB,EAA2B,WAA3B,CAAP;AACD,CAFD;;AAIA,IAAIE,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,SAA3B,EAAsCC,UAAtC,EAAkD;AACxE,SAAO,eAAeH,MAAf,CAAsBE,SAAtB,EAAiC,GAAjC,EAAsCF,MAAtC,CAA6CG,UAA7C,CAAP;AACD,CAFD;;AAIA,IAAIC,eAAe,GAAG,SAASA,eAAT,CAAyBF,SAAzB,EAAoCG,QAApC,EAA8C;AAClE,SAAO,cAAcL,MAAd,CAAqBE,SAArB,EAAgC,GAAhC,EAAqCF,MAArC,CAA4CK,QAA5C,CAAP;AACD,CAFD;;AAIA,IAAIC,eAAe,GACnB,aACA,YAAY;AACV,MAAIC,IAAI,GAAG,CAAC,GAAG3C,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASC,OAAT,CAAiBC,GAAjB,EAAsBR,SAAtB,EAAiC;AAC5D,QAAIS,GAAJ,EAASC,MAAT;AACA,WAAOjD,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC9D,aAAO,CAAP,EAAU;AACR,gBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;AACE,eAAK,CAAL;AACE,gBAAI,CAACP,GAAG,CAACQ,UAAJ,CAAe,IAAf,CAAL,EAA2B;AACzBH,cAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA;AACD;;AAEDF,YAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA,mBAAOzB,GAAG,CAAC2B,WAAJ,CAAgBT,GAAhB,EAAqBR,SAArB,CAAP;;AAEF,eAAK,CAAL;AACEQ,YAAAA,GAAG,GAAGK,QAAQ,CAACK,IAAf;;AAEF,eAAK,CAAL;AACEL,YAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA,mBAAOpB,UAAU,CAACa,GAAD,CAAjB;;AAEF,eAAK,CAAL;AACEC,YAAAA,GAAG,GAAGI,QAAQ,CAACK,IAAf;AACAR,YAAAA,MAAM,GAAGD,GAAG,CAACU,SAAJ,CAAcC,IAAd,CAAmB,UAAUrC,GAAV,EAAe;AACzC,qBAAOA,GAAG,CAACsC,EAAJ,CAAOC,QAAP,CAAgB,mBAAhB,CAAP;AACD,aAFQ,CAAT;;AAIA,gBAAIZ,MAAJ,EAAY;AACVG,cAAAA,QAAQ,CAACE,IAAT,GAAgB,EAAhB;AACA;AACD;;AAEDF,YAAAA,QAAQ,CAACE,IAAT,GAAgB,EAAhB;AACA,mBAAOzB,GAAG,CAAC2B,WAAJ,CAAgBT,GAAhB,EAAqBR,SAArB,CAAP;;AAEF,eAAK,EAAL;AACEQ,YAAAA,GAAG,GAAGK,QAAQ,CAACK,IAAf;AACAL,YAAAA,QAAQ,CAACE,IAAT,GAAgB,EAAhB;AACA,mBAAOpB,UAAU,CAACa,GAAD,CAAjB;;AAEF,eAAK,EAAL;AACEC,YAAAA,GAAG,GAAGI,QAAQ,CAACK,IAAf;AACAR,YAAAA,MAAM,GAAGD,GAAG,CAACU,SAAJ,CAAcC,IAAd,CAAmB,UAAUrC,GAAV,EAAe;AACzC,qBAAOA,GAAG,CAACsC,EAAJ,CAAOC,QAAP,CAAgB,mBAAhB,CAAP;AACD,aAFQ,CAAT;;AAIF,eAAK,EAAL;AACE,mBAAOT,QAAQ,CAACU,MAAT,CAAgB,QAAhB,EAA0Bb,MAAM,CAACc,eAAjC,CAAP;;AAEF,eAAK,EAAL;AACA,eAAK,KAAL;AACE,mBAAOX,QAAQ,CAACY,IAAT,EAAP;AA/CJ;AAiDD;AACF,KApDM,EAoDJlB,OApDI,CAAP;AAqDD,GAvDD,CAFW,CAAX;;AA2DA,SAAO,SAASH,eAAT,CAAyBsB,EAAzB,EAA6BC,GAA7B,EAAkC;AACvC,WAAOtB,IAAI,CAAC9B,KAAL,CAAW,IAAX,EAAiBI,SAAjB,CAAP;AACD,GAFD;AAGD,CA/DD,EAFA;AAkEA;;;AAGA,IAAIiD,IAAI,GACR,aACA,YAAY;AACV,WAASA,IAAT,CAAc5B,SAAd,EAAyB6B,OAAzB,EAAkC;AAChC,KAAC,GAAGtE,gBAAgB,CAAC,SAAD,CAApB,EAAiC,IAAjC,EAAuCqE,IAAvC;AACA,SAAKE,KAAL,GAAa9B,SAAb;AACA,SAAK+B,IAAL,GAAYF,OAAZ;AACD;AACD;;;;;AAKA,GAAC,GAAGrE,aAAa,CAAC,SAAD,CAAjB,EAA8BoE,IAA9B,EAAoC,CAAC;AACnC7C,IAAAA,GAAG,EAAE,WAD8B;;AAGnC;;;;;;;;AAQAiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIC,UAAU,GAAG,CAAC,GAAGvE,kBAAkB,CAAC,SAAD,CAAtB,GACjB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS4B,QAAT,CAAkBC,OAAlB,EAA2B;AACtD,YAAIC,IAAJ;AAAA,YACIC,MAAM,GAAG1D,SADb;AAEA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS2B,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACzB,IAAV,GAAiByB,SAAS,CAACxB,IAAnC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAGC,MAAM,CAACzD,MAAP,GAAgB,CAAhB,IAAqByD,MAAM,CAAC,CAAD,CAAN,KAAcG,SAAnC,GAA+CH,MAAM,CAAC,CAAD,CAArD,GAA2D,EAAlE;AACA,uBAAOE,SAAS,CAAChB,MAAV,CAAiB,QAAjB,EAA2B,KAAKQ,IAAL,CAAUU,OAAV,CAAkBN,OAAlB,EAA2BpE,MAAM,CAAC2E,MAAP,CAAcN,IAAd,EAAoB;AAC/EO,kBAAAA,KAAK,EAAE,KAAKb;AADmE,iBAApB,CAA3B,CAA3B,CAAP;;AAIF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOS,SAAS,CAACd,IAAV,EAAP;AATJ;AAWD;AACF,SAdM,EAcJS,QAdI,EAcM,IAdN,CAAP;AAeD,OAlBD,CAFiB,CAAjB;;AAsBA,eAASU,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,eAAOZ,UAAU,CAAC1D,KAAX,CAAiB,IAAjB,EAAuBI,SAAvB,CAAP;AACD;;AAED,aAAOiE,SAAP;AACD,KA5BM;AA6BP;;;;;;;;;;;;AAxCmC,GAAD,EAoDjC;AACD7D,IAAAA,GAAG,EAAE,SADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIc,QAAQ,GAAG,CAAC,GAAGpF,kBAAkB,CAAC,SAAD,CAAtB,GACf,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyC,QAAT,CAAkBC,OAAlB,EAA2B;AACtD,YAAIC,KAAJ;AAAA,YACIC,EADJ;AAAA,YAEIC,QAFJ;AAAA,YAGIC,MAAM,GAAGzE,SAHb;;AAKA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS0C,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACxC,IAAV,GAAiBwC,SAAS,CAACvC,IAAnC;AACE,mBAAK,CAAL;AACEkC,gBAAAA,KAAK,GAAGG,MAAM,CAACxE,MAAP,GAAgB,CAAhB,IAAqBwE,MAAM,CAAC,CAAD,CAAN,KAAcZ,SAAnC,GAA+CY,MAAM,CAAC,CAAD,CAArD,GAA2D,EAAnE,EAAuEF,EAAE,GAAGD,KAAK,CAACC,EAAlF;;AAEA,oBAAI,CAACA,EAAL,EAAS;AACPI,kBAAAA,SAAS,CAACvC,IAAV,GAAiB,CAAjB;AACA;AACD;;AAEDuC,gBAAAA,SAAS,CAACvC,IAAV,GAAiB,CAAjB;AACA,uBAAOX,eAAe,CAAC8C,EAAD,EAAK,KAAKpB,KAAV,CAAtB;;AAEF,mBAAK,CAAL;AACEqB,gBAAAA,QAAQ,GAAGG,SAAS,CAACpC,IAArB;;AAEF,mBAAK,CAAL;AACE,uBAAOoC,SAAS,CAAC/B,MAAV,CAAiB,QAAjB,EAA2B,KAAKQ,IAAL,CAAUwB,OAAV,CAAkBP,OAAlB,EAA2B,KAAKlB,KAAhC,EAAuCqB,QAAvC,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOG,SAAS,CAAC7B,IAAV,EAAP;AApBJ;AAsBD;AACF,SAzBM,EAyBJsB,QAzBI,EAyBM,IAzBN,CAAP;AA0BD,OAhCD,CAFe,CAAf;;AAoCA,eAASQ,OAAT,CAAiBC,GAAjB,EAAsB;AACpB,eAAOV,QAAQ,CAACvE,KAAT,CAAe,IAAf,EAAqBI,SAArB,CAAP;AACD;;AAED,aAAO4E,OAAP;AACD,KA1CM;AA2CP;;;;;;;;AA7CC,GApDiC,EAyGjC;AACDxE,IAAAA,GAAG,EAAE,SADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIyB,QAAQ,GAAG,CAAC,GAAG/F,kBAAkB,CAAC,SAAD,CAAtB,GACf,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASoD,QAAT,CAAkBC,eAAlB,EAAmCC,QAAnC,EAA6C;AACxE,eAAOnG,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASkD,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAAChD,IAAV,GAAiBgD,SAAS,CAAC/C,IAAnC;AACE,mBAAK,CAAL;AACE,uBAAO+C,SAAS,CAACvC,MAAV,CAAiB,QAAjB,EAA2B,KAAKQ,IAAL,CAAUgC,OAAV,CAAkBJ,eAAlB,EAAmC,KAAK7B,KAAxC,EAA+C8B,QAA/C,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOE,SAAS,CAACrC,IAAV,EAAP;AANJ;AAQD;AACF,SAXM,EAWJiC,QAXI,EAWM,IAXN,CAAP;AAYD,OAbD,CAFe,CAAf;;AAiBA,eAASK,OAAT,CAAiBC,GAAjB,EAAsBC,GAAtB,EAA2B;AACzB,eAAOR,QAAQ,CAAClF,KAAT,CAAe,IAAf,EAAqBI,SAArB,CAAP;AACD;;AAED,aAAOoF,OAAP;AACD,KAvBM;AAFN,GAzGiC,EAmIjC;AACDhF,IAAAA,GAAG,EAAE,KADJ;AAEDmF,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,aAAO,KAAKnC,IAAL,CAAUoC,SAAV,CAAoB,KAAKrC,KAAzB,CAAP;AACD;AAJA,GAnIiC,CAApC;AAyIA,SAAOF,IAAP;AACD,CArJD,EAFA;;AAyJA,IAAIwC,KAAK,GACT,aACA,YAAY;AACV;;;AAGA,WAASA,KAAT,CAAevE,IAAf,EAAqBwE,UAArB,EAAiC;AAC/B,KAAC,GAAG9G,gBAAgB,CAAC,SAAD,CAApB,EAAiC,IAAjC,EAAuC6G,KAAvC;AACA,SAAKtC,KAAL,GAAajC,IAAb;AACA,SAAKyE,WAAL,GAAmBD,UAAnB;AACA,SAAKE,MAAL,GAAc,IAAIpF,aAAJ,CAAkBS,eAAe,CAAC,KAAKkC,KAAN,CAAjC,EAA+C,KAAKwC,WAApD,CAAd;AACA,SAAKE,cAAL,GAAsB,EAAtB;AACA;;;;AAIA,SAAK,QAAL,IAAiB,IAAjB;AACA;;;;AAIA,SAAK,SAAL,IAAkB,IAAlB;AACA;;;;AAIA,SAAKC,QAAL,GAAgB,IAAhB;AACD;;AAED,GAAC,GAAGjH,aAAa,CAAC,SAAD,CAAjB,EAA8B4G,KAA9B,EAAqC,CAAC;AACpCrF,IAAAA,GAAG,EAAE,MAD+B;AAEpCiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI0C,KAAK,GAAG,CAAC,GAAGhH,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASqE,QAAT,CAAkB9C,OAAlB,EAA2B;AACtD,YAAI+C,KAAK,GAAG,IAAZ;;AAEA,YAAIxC,IAAJ;AAAA,YACIyC,aADJ;AAAA,YAEIC,SAFJ;AAAA,YAGIC,MAAM,GAAGpG,SAHb;AAIA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASqE,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACnE,IAAV,GAAiBmE,SAAS,CAAClE,IAAnC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAG2C,MAAM,CAACnG,MAAP,GAAgB,CAAhB,IAAqBmG,MAAM,CAAC,CAAD,CAAN,KAAcvC,SAAnC,GAA+CuC,MAAM,CAAC,CAAD,CAArD,GAA2D,EAAlE;;AAEA,oBAAI,KAAKG,MAAT,EAAiB;AACfD,kBAAAA,SAAS,CAAClE,IAAV,GAAiB,EAAjB;AACA;AACD,iBANH,CAQE;;;AACA,qBAAKgB,IAAL,GAAYF,OAAZ;AACAoD,gBAAAA,SAAS,CAAClE,IAAV,GAAiB,CAAjB;AACA,uBAAO,KAAKgB,IAAL,CAAUoD,eAAV,CAA0B,CAAC,KAAKrD,KAAN,CAA1B,CAAP;;AAEF,mBAAK,CAAL;AACE+C,gBAAAA,aAAa,GAAGI,SAAS,CAAC/D,IAA1B;;AAEA,oBAAI2D,aAAJ,EAAmB;AACjBI,kBAAAA,SAAS,CAAClE,IAAV,GAAiB,CAAjB;AACA;AACD;;AAEDkE,gBAAAA,SAAS,CAAClE,IAAV,GAAiB,CAAjB;AACA,uBAAO,KAAKgB,IAAL,CAAUqD,YAAV,CAAuB,CAAC,KAAKtD,KAAN,CAAvB,CAAP;;AAEF,mBAAK,CAAL;AACE,oBAAIM,IAAI,CAACiD,eAAT,EAA0BjD,IAAI,CAACiD,eAAL,CAAqB,CAACR,aAAtB,EAAqC,KAAK/C,KAA1C;AAC1BmD,gBAAAA,SAAS,CAAClE,IAAV,GAAiB,EAAjB;AACA,uBAAO,KAAKwD,MAAL,CAAYe,KAAZ,CAAkB,KAAKvD,IAAvB,CAAP;;AAEF,mBAAK,EAAL;AACE+C,gBAAAA,SAAS,GACT,aACA,YAAY;AACV,sBAAIS,KAAK,GAAG,CAAC,GAAG7H,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASkF,QAAT,GAAoB;AAC/C,2BAAO/H,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS8E,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,6BAAO,CAAP,EAAU;AACR,gCAAQA,SAAS,CAAC5E,IAAV,GAAiB4E,SAAS,CAAC3E,IAAnC;AACE,+BAAK,CAAL;AACE2E,4BAAAA,SAAS,CAAC3E,IAAV,GAAiB,CAAjB;AACA,mCAAO6D,KAAK,CAACL,MAAN,CAAaoB,KAAb,EAAP;;AAEF,+BAAK,CAAL;AACE,gCAAIvD,IAAI,CAACwD,UAAT,EAAqBxD,IAAI,CAACwD,UAAL;;AAEvB,+BAAK,CAAL;AACA,+BAAK,KAAL;AACE,mCAAOF,SAAS,CAACjE,IAAV,EAAP;AAVJ;AAYD;AACF,qBAfM,EAeJ+D,QAfI,CAAP;AAgBD,mBAjBD,CAFY,CAAZ;;AAqBA,yBAAO,SAASV,SAAT,GAAqB;AAC1B,2BAAOS,KAAK,CAAChH,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD,mBAFD;AAGD,iBAzBD,EAFA;;AA6BA,qBAAK8F,QAAL,GAAgBK,SAAS,EAAzB;AACA,qBAAK,QAAL,IAAiBe,kBAAkB,CAAC,KAAKtB,MAAN,CAAnC;AACA,qBAAK,SAAL,IAAkBuB,mBAAmB,CAAC,KAAKvB,MAAN,EAAc,KAAKxC,IAAnB,EAAyB,KAAKD,KAA9B,CAArC,CAhCF,CAgC6E;;AAE3EmD,gBAAAA,SAAS,CAAClE,IAAV,GAAiB,EAAjB;AACA,uBAAO,KAAKgF,YAAL,CAAkB,KAAKhE,IAAvB,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOkD,SAAS,CAACxD,IAAV,EAAP;AArEJ;AAuED;AACF,SA1EM,EA0EJkD,QA1EI,EA0EM,IA1EN,CAAP;AA2ED,OAlFD,CAFY,CAAZ;;AAsFA,eAASqB,IAAT,CAAcC,GAAd,EAAmB;AACjB,eAAOvB,KAAK,CAACnG,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD;;AAED,aAAOqH,IAAP;AACD,KA5FM;AAF6B,GAAD,EA+FlC;AACDjH,IAAAA,GAAG,EAAE,cADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIkE,aAAa,GAAG,CAAC,GAAGxI,kBAAkB,CAAC,SAAD,CAAtB,GACpB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS6F,QAAT,CAAkBtE,OAAlB,EAA2B;AACtD,YAAIuE,WAAJ;AACA,eAAO3I,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS0F,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACxF,IAAV,GAAiBwF,SAAS,CAACvF,IAAnC;AACE,mBAAK,CAAL;AACEuF,gBAAAA,SAAS,CAACvF,IAAV,GAAiB,CAAjB;AACA,uBAAOc,OAAO,CAAC0E,QAAR,CAAiB,KAAKzE,KAAtB,CAAP;;AAEF,mBAAK,CAAL;AACEsE,gBAAAA,WAAW,GAAGE,SAAS,CAACpF,IAAxB;AACAnD,gBAAAA,MAAM,CAACyI,MAAP,CAAc,KAAKhC,cAAnB,EAAmC1F,OAAnC,CAA2C,UAAU2H,MAAV,EAAkB;AAC3D,sBAAIA,MAAM,CAACC,OAAX,EAAoB;AAClBD,oBAAAA,MAAM,CAACE,OAAP,CAAe9E,OAAf;AACD,mBAFD,MAEO;AACL4E,oBAAAA,MAAM,CAACG,YAAP,CAAoBR,WAApB;AACD;AACF,iBAND;;AAQF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOE,SAAS,CAAC7E,IAAV,EAAP;AAjBJ;AAmBD;AACF,SAtBM,EAsBJ0E,QAtBI,EAsBM,IAtBN,CAAP;AAuBD,OAzBD,CAFoB,CAApB;;AA6BA,eAASJ,YAAT,CAAsBc,GAAtB,EAA2B;AACzB,eAAOX,aAAa,CAAC3H,KAAd,CAAoB,IAApB,EAA0BI,SAA1B,CAAP;AACD;;AAED,aAAOoH,YAAP;AACD,KAnCM;AAoCP;;;;;;;;;;;;;;;;AAtCC,GA/FkC,EAqJlC;AACDhH,IAAAA,GAAG,EAAE,YADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI8E,WAAW,GAAG,CAAC,GAAGpJ,kBAAkB,CAAC,SAAD,CAAtB,GAClB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyG,QAAT,CAAkBlH,IAAlB,EAAwB;AACnD,YAAIuC,IAAJ;AAAA,YACI4E,YADJ;AAAA,YAEIC,WAFJ;AAAA,YAGIC,IAHJ;AAAA,YAIIT,MAJJ;AAAA,YAKIU,OALJ;AAAA,YAMIC,MAAM,GAAGzI,SANb;AAOA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS0G,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAACxG,IAAV,GAAiBwG,SAAS,CAACvG,IAAnC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAGgF,MAAM,CAACxI,MAAP,GAAgB,CAAhB,IAAqBwI,MAAM,CAAC,CAAD,CAAN,KAAc5E,SAAnC,GAA+C4E,MAAM,CAAC,CAAD,CAArD,GAA2D,EAAlE;;AAEA,oBAAI,CAAChF,IAAI,CAACmF,KAAV,EAAiB;AACfD,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,CAAjB;AACA;AACD;;AAEDiG,gBAAAA,YAAY,GAAG9G,eAAe,CAAC,KAAK4B,KAAN,EAAajC,IAAb,CAA9B;;AAEA,oBAAI,CAAC,KAAK2E,cAAL,CAAoBwC,YAApB,CAAL,EAAwC;AACtC,uBAAKxC,cAAL,CAAoBwC,YAApB,IAAoC,IAAI3H,WAAJ,CAAgB2H,YAAhB,EAA8B,KAAK1C,WAAnC,EAAgD,KAAKvC,IAArD,EAA2DK,IAA3D,CAApC;AACD;;AAED,oBAAI,KAAKL,IAAT,EAAe;AACb,uBAAKyC,cAAL,CAAoBwC,YAApB,EAAkCL,OAAlC,CAA0C,KAAK5E,IAA/C;AACD;;AAED,uBAAOuF,SAAS,CAAC/F,MAAV,CAAiB,QAAjB,EAA2B,KAAKiD,cAAL,CAAoBwC,YAApB,CAA3B,CAAP;;AAEF,mBAAK,CAAL;AACEC,gBAAAA,WAAW,GAAG7E,IAAI,CAACoF,SAAL,GAAiB,YAAY,CAAE,CAA/B,GAAkC,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAAhD;;AAEA,oBAAI,CAACtF,IAAI,CAACuF,YAAV,EAAwB;AACtBL,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAED,oBAAI,KAAKgB,IAAT,EAAe;AACbuF,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,uDAAV,CAAN;;AAEF,mBAAK,EAAL;AACE,oBAAIxF,IAAI,CAACyF,cAAT,EAAyB;AACvBP,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAED,oBAAI,KAAKgB,IAAT,EAAe;AACbuF,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,8CAAV,CAAN;;AAEF,mBAAK,EAAL;AACExF,gBAAAA,IAAI,CAACyF,cAAL,GAAsB,KAAK9F,IAAL,CAAUoC,SAAV,CAAoB,KAAKrC,KAAzB,CAAtB;;AAEF,mBAAK,EAAL;AACEoF,gBAAAA,IAAI,GAAG,KAAKnF,IAAL,GAAY,KAAKmF,IAAjB,GAAwB,EAA/B;AACAT,gBAAAA,MAAM,GAAG,IAAIrH,MAAJ,CAAWW,iBAAiB,CAAC,KAAK+B,KAAN,EAAajC,IAAb,CAA5B,EAAgD,KAAKyE,WAArD,EAAkElC,IAAI,CAAC0F,OAAvE,EAAgF1F,IAAI,CAACyF,cAArF,EAAqGzF,IAAI,CAACuF,YAA1G,EAAwHT,IAAxH,EAA8HD,WAA9H,CAAT;AACAK,gBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA,uBAAO0F,MAAM,CAACsB,iBAAP,EAAP;;AAEF,mBAAK,EAAL;AACEZ,gBAAAA,OAAO,GAAGG,SAAS,CAACpG,IAApB;;AAEA,oBAAI,CAAC,KAAKsD,cAAL,CAAoB2C,OAApB,CAAL,EAAmC;AACjCG,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAED,uBAAOuG,SAAS,CAAC/F,MAAV,CAAiB,QAAjB,EAA2B,KAAKiD,cAAL,CAAoB2C,OAApB,CAA3B,CAAP;;AAEF,mBAAK,EAAL;AACEG,gBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA,uBAAO0F,MAAM,CAACnB,KAAP,EAAP;;AAEF,mBAAK,EAAL;AACE,oBAAI,CAAC,KAAKvD,IAAV,EAAgB;AACduF,kBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA;AACD;;AAEDuG,gBAAAA,SAAS,CAACU,EAAV,GAAevB,MAAf;AACAa,gBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA,uBAAO,KAAKgB,IAAL,CAAUwE,QAAV,CAAmB,KAAKzE,KAAxB,CAAP;;AAEF,mBAAK,EAAL;AACEwF,gBAAAA,SAAS,CAACW,EAAV,GAAeX,SAAS,CAACpG,IAAzB;AACAoG,gBAAAA,SAAS,CAACvG,IAAV,GAAiB,EAAjB;AACA,uBAAOuG,SAAS,CAACU,EAAV,CAAapB,YAAb,CAA0BsB,IAA1B,CAA+BZ,SAAS,CAACU,EAAzC,EAA6CV,SAAS,CAACW,EAAvD,CAAP;;AAEF,mBAAK,EAAL;AACE,qBAAKzD,cAAL,CAAoB2C,OAApB,IAA+BV,MAA/B;AACA,uBAAOa,SAAS,CAAC/F,MAAV,CAAiB,QAAjB,EAA2BkF,MAA3B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOa,SAAS,CAAC7F,IAAV,EAAP;AA7FJ;AA+FD;AACF,SAlGM,EAkGJsF,QAlGI,EAkGM,IAlGN,CAAP;AAmGD,OA3GD,CAFkB,CAAlB;;AA+GA,eAASoB,UAAT,CAAoBC,GAApB,EAAyB;AACvB,eAAOtB,WAAW,CAACvI,KAAZ,CAAkB,IAAlB,EAAwBI,SAAxB,CAAP;AACD;;AAED,aAAOwJ,UAAP;AACD,KArHM;AAsHP;;;;;;;;AAxHC,GArJkC,EAqRlC;AACDpJ,IAAAA,GAAG,EAAE,0BADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIqG,yBAAyB,GAAG,CAAC,GAAG3K,kBAAkB,CAAC,SAAD,CAAtB,GAChC,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASgI,QAAT,CAAkBzI,IAAlB,EAAwB;AACnD,eAAOpC,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS4H,SAAT,CAAmBC,SAAnB,EAA8B;AAChE,iBAAO,CAAP,EAAU;AACR,oBAAQA,SAAS,CAAC1H,IAAV,GAAiB0H,SAAS,CAACzH,IAAnC;AACE,mBAAK,CAAL;AACE,uBAAOyH,SAAS,CAACjH,MAAV,CAAiB,QAAjB,EAA2B,KAAK4G,UAAL,CAAgBtI,IAAhB,EAAsB;AACtD8H,kBAAAA,YAAY,EAAE;AADwC,iBAAtB,CAA3B,CAAP;;AAIF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOa,SAAS,CAAC/G,IAAV,EAAP;AARJ;AAUD;AACF,SAbM,EAaJ6G,QAbI,EAaM,IAbN,CAAP;AAcD,OAfD,CAFgC,CAAhC;;AAmBA,eAASG,wBAAT,CAAkCC,IAAlC,EAAwC;AACtC,eAAOL,yBAAyB,CAAC9J,KAA1B,CAAgC,IAAhC,EAAsCI,SAAtC,CAAP;AACD;;AAED,aAAO8J,wBAAP;AACD,KAzBM;AA0BP;;;;;;;;;;AA5BC,GArRkC,EA2TlC;AACD1J,IAAAA,GAAG,EAAE,qBADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI2G,oBAAoB,GAAG,CAAC,GAAGjL,kBAAkB,CAAC,SAAD,CAAtB,GAC3B,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASsI,SAAT,CAAmBzB,OAAnB,EAA4B;AACvD,YAAI/E,IAAJ;AAAA,YACIyG,WADJ;AAAA,YAEI5I,UAFJ;AAAA,YAGIgH,WAHJ;AAAA,YAIIC,IAJJ;AAAA,YAKIT,MALJ;AAAA,YAMIqC,OAAO,GAAGnK,SANd;AAOA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASoI,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAClI,IAAX,GAAkBkI,UAAU,CAACjI,IAArC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAG0G,OAAO,CAAClK,MAAR,GAAiB,CAAjB,IAAsBkK,OAAO,CAAC,CAAD,CAAP,KAAetG,SAArC,GAAiDsG,OAAO,CAAC,CAAD,CAAxD,GAA8D,EAArE;;AAEA,oBAAIpJ,cAAc,CAACuJ,OAAf,CAAuB9B,OAAvB,CAAJ,EAAqC;AACnC6B,kBAAAA,UAAU,CAACjI,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,qDAAV,CAAN;;AAEF,mBAAK,CAAL;AACE,oBAAI,KAAK1C,MAAT,EAAiB;AACf8D,kBAAAA,UAAU,CAACjI,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,+CAAV,CAAN;;AAEF,mBAAK,CAAL;AACEiB,gBAAAA,WAAW,GAAG1B,OAAO,CAAC+B,KAAR,CAAc,GAAd,EAAmB,CAAnB,CAAd;AACAjJ,gBAAAA,UAAU,GAAGkH,OAAO,CAAC+B,KAAR,CAAc,GAAd,EAAmB,CAAnB,CAAb;;AAEA,oBAAI,EAAEL,WAAW,KAAK,KAAK/G,KAAvB,CAAJ,EAAmC;AACjCkH,kBAAAA,UAAU,CAACjI,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,kGAAV,CAAN;;AAEF,mBAAK,CAAL;AACE,oBAAI,CAAC,KAAKpD,cAAL,CAAoB2C,OAApB,CAAL,EAAmC;AACjC6B,kBAAAA,UAAU,CAACjI,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED,uBAAOiI,UAAU,CAACzH,MAAX,CAAkB,QAAlB,EAA4B,KAAKiD,cAAL,CAAoB2C,OAApB,CAA5B,CAAP;;AAEF,mBAAK,EAAL;AACEF,gBAAAA,WAAW,GAAG7E,IAAI,CAACoF,SAAL,GAAiB,YAAY,CAAE,CAA/B,GAAkC,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAAhD;AACAR,gBAAAA,IAAI,GAAG,KAAKnF,IAAL,GAAY,KAAKmF,IAAjB,GAAwB,EAA/B;AACAT,gBAAAA,MAAM,GAAG,IAAIrH,MAAJ,CAAWW,iBAAiB,CAAC,KAAK+B,KAAN,EAAa7B,UAAb,CAA5B,EAAsD,KAAKqE,WAA3D,EAAwE9B,SAAxE,EAAmFA,SAAnF,EAA8FA,SAA9F,EAAyG0E,IAAzG,EAA+GD,WAA/G,CAAT;AACA+B,gBAAAA,UAAU,CAACjI,IAAX,GAAkB,EAAlB;AACA,uBAAO0F,MAAM,CAACnB,KAAP,CAAa6B,OAAb,CAAP;;AAEF,mBAAK,EAAL;AACE,oBAAI,CAAC,KAAKpF,IAAV,EAAgB;AACdiH,kBAAAA,UAAU,CAACjI,IAAX,GAAkB,EAAlB;AACA;AACD;;AAEDiI,gBAAAA,UAAU,CAAChB,EAAX,GAAgBvB,MAAhB;AACAuC,gBAAAA,UAAU,CAACjI,IAAX,GAAkB,EAAlB;AACA,uBAAO,KAAKgB,IAAL,CAAUwE,QAAV,CAAmB,KAAKzE,KAAxB,CAAP;;AAEF,mBAAK,EAAL;AACEkH,gBAAAA,UAAU,CAACf,EAAX,GAAgBe,UAAU,CAAC9H,IAA3B;AACA8H,gBAAAA,UAAU,CAACjI,IAAX,GAAkB,EAAlB;AACA,uBAAOiI,UAAU,CAAChB,EAAX,CAAcpB,YAAd,CAA2BsB,IAA3B,CAAgCc,UAAU,CAAChB,EAA3C,EAA+CgB,UAAU,CAACf,EAA1D,CAAP;;AAEF,mBAAK,EAAL;AACE,qBAAKzD,cAAL,CAAoB2C,OAApB,IAA+BV,MAA/B;AACA,uBAAOuC,UAAU,CAACzH,MAAX,CAAkB,QAAlB,EAA4BkF,MAA5B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOuC,UAAU,CAACvH,IAAX,EAAP;AAlEJ;AAoED;AACF,SAvEM,EAuEJmH,SAvEI,EAuEO,IAvEP,CAAP;AAwED,OAhFD,CAF2B,CAA3B;;AAoFA,eAASO,mBAAT,CAA6BC,IAA7B,EAAmC;AACjC,eAAOT,oBAAoB,CAACpK,KAArB,CAA2B,IAA3B,EAAiCI,SAAjC,CAAP;AACD;;AAED,aAAOwK,mBAAP;AACD,KA1FM;AA2FP;;;;;;;;;;AA7FC,GA3TkC,EAkalC;AACDpK,IAAAA,GAAG,EAAE,iBADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIqH,gBAAgB,GAAG,CAAC,GAAG3L,kBAAkB,CAAC,SAAD,CAAtB,GACvB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASgJ,SAAT,CAAmBnC,OAAnB,EAA4B;AACvD,YAAIoC,MAAJ;AAAA,YACIC,SADJ;AAAA,YAEIC,OAAO,GAAG9K,SAFd;AAGA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS+I,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC7I,IAAX,GAAkB6I,UAAU,CAAC5I,IAArC;AACE,mBAAK,CAAL;AACEwI,gBAAAA,MAAM,GAAGE,OAAO,CAAC7K,MAAR,GAAiB,CAAjB,IAAsB6K,OAAO,CAAC,CAAD,CAAP,KAAejH,SAArC,GAAiDiH,OAAO,CAAC,CAAD,CAAxD,GAA8D,EAAvE;;AAEA,oBAAI/J,cAAc,CAACuJ,OAAf,CAAuB9B,OAAvB,CAAJ,EAAqC;AACnCwC,kBAAAA,UAAU,CAAC5I,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,iEAAV,CAAN;;AAEF,mBAAK,CAAL;AACE,oBAAI,KAAK1C,MAAT,EAAiB;AACfyE,kBAAAA,UAAU,CAAC5I,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,uBAAO4I,UAAU,CAACpI,MAAX,CAAkB,QAAlB,CAAP;;AAEF,mBAAK,CAAL;AACE;AACAiI,gBAAAA,SAAS,GAAG,UAAU1J,MAAV,CAAiBqH,OAAjB,CAAZ;AACAwC,gBAAAA,UAAU,CAAC5I,IAAX,GAAkB,CAAlB;AACA,uBAAO,KAAK0D,QAAZ;;AAEF,mBAAK,CAAL;AACEkF,gBAAAA,UAAU,CAAC5I,IAAX,GAAkB,EAAlB;AACA,uBAAO,KAAK,QAAL,EAAemD,GAAf,CAAmBsF,SAAnB,CAAP;;AAEF,mBAAK,EAAL;AACE,oBAAIG,UAAU,CAACzI,IAAf,EAAqB;AACnByI,kBAAAA,UAAU,CAAC5I,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED4I,gBAAAA,UAAU,CAAC5I,IAAX,GAAkB,EAAlB;AACA,uBAAO,KAAK,QAAL,EAAe6I,GAAf,CAAmBJ,SAAnB,EAA8BzL,MAAM,CAAC2E,MAAP,CAAc,EAAd,EAAkB6G,MAAlB,EAA0B;AAC7DpC,kBAAAA,OAAO,EAAEA;AADoD,iBAA1B,CAA9B,CAAP;;AAIF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOwC,UAAU,CAAClI,IAAX,EAAP;AA1CJ;AA4CD;AACF,SA/CM,EA+CJ6H,SA/CI,EA+CO,IA/CP,CAAP;AAgDD,OApDD,CAFuB,CAAvB;;AAwDA,eAAS7B,eAAT,CAAyBoC,IAAzB,EAA+B;AAC7B,eAAOR,gBAAgB,CAAC9K,KAAjB,CAAuB,IAAvB,EAA6BI,SAA7B,CAAP;AACD;;AAED,aAAO8I,eAAP;AACD,KA9DM;AA+DP;;;;;;AAjEC,GAlakC,EAyelC;AACD1I,IAAAA,GAAG,EAAE,mBADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAI8H,kBAAkB,GAAG,CAAC,GAAGpM,kBAAkB,CAAC,SAAD,CAAtB,GACzB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyJ,SAAT,CAAmB5C,OAAnB,EAA4B;AACvD,YAAIqC,SAAJ;AACA,eAAO/L,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASqJ,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACnJ,IAAX,GAAkBmJ,UAAU,CAAClJ,IAArC;AACE,mBAAK,CAAL;AACE,oBAAI,KAAKmE,MAAT,EAAiB;AACf+E,kBAAAA,UAAU,CAAClJ,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,6CAAV,CAAN;;AAEF,mBAAK,CAAL;AACE4B,gBAAAA,SAAS,GAAG,UAAU1J,MAAV,CAAiBqH,OAAjB,CAAZ;AACA8C,gBAAAA,UAAU,CAAClJ,IAAX,GAAkB,CAAlB;AACA,uBAAO,KAAK,QAAL,EAAemD,GAAf,CAAmBsF,SAAnB,CAAP;;AAEF,mBAAK,CAAL;AACE,oBAAI,CAACS,UAAU,CAAC/I,IAAhB,EAAsB;AACpB+I,kBAAAA,UAAU,CAAClJ,IAAX,GAAkB,CAAlB;AACA;AACD;;AAEDkJ,gBAAAA,UAAU,CAAClJ,IAAX,GAAkB,CAAlB;AACA,uBAAO,KAAK,QAAL,EAAemJ,MAAf,CAAsBV,SAAtB,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOS,UAAU,CAACxI,IAAX,EAAP;AAzBJ;AA2BD;AACF,SA9BM,EA8BJsI,SA9BI,EA8BO,IA9BP,CAAP;AA+BD,OAjCD,CAFyB,CAAzB;;AAqCA,eAASI,iBAAT,CAA2BC,IAA3B,EAAiC;AAC/B,eAAON,kBAAkB,CAACvL,KAAnB,CAAyB,IAAzB,EAA+BI,SAA/B,CAAP;AACD;;AAED,aAAOwL,iBAAP;AACD,KA3CM;AA4CP;;;;;;AA9CC,GAzekC,EA6hBlC;AACDpL,IAAAA,GAAG,EAAE,mBADJ;AAEDiD,IAAAA,KAAK,EAAE,YAAY;AACjB,UAAIqI,kBAAkB,GAAG,CAAC,GAAG3M,kBAAkB,CAAC,SAAD,CAAtB,GACzB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASgK,SAAT,GAAqB;AAChD,YAAIC,UAAJ;AACA,eAAO9M,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS6J,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC3J,IAAX,GAAkB2J,UAAU,CAAC1J,IAArC;AACE,mBAAK,CAAL;AACE,oBAAI,KAAKmE,MAAT,EAAiB;AACfuF,kBAAAA,UAAU,CAAC1J,IAAX,GAAkB,CAAlB;AACA;AACD;;AAED,sBAAM,IAAI6G,KAAJ,CAAU,6CAAV,CAAN;;AAEF,mBAAK,CAAL;AACE6C,gBAAAA,UAAU,CAAC1J,IAAX,GAAkB,CAAlB;AACA,uBAAO,KAAK,QAAL,EAAe2J,GAAf,EAAP;;AAEF,mBAAK,CAAL;AACEH,gBAAAA,UAAU,GAAGE,UAAU,CAACvJ,IAAxB;AACA,uBAAOuJ,UAAU,CAAClJ,MAAX,CAAkB,QAAlB,EAA4BxD,MAAM,CAACD,IAAP,CAAYyM,UAAZ,EAAwBI,MAAxB,CAA+B,UAAUC,OAAV,EAAmB7L,GAAnB,EAAwB;AACxF,sBAAIA,GAAG,CAACiC,UAAJ,CAAe,QAAf,CAAJ,EAA8B;AAC5B;AACA,wBAAImG,OAAO,GAAGpI,GAAG,CAACmK,KAAJ,CAAU,SAAV,EAAqB,CAArB,CAAd;;AAEA,wBAAIxJ,cAAc,CAACuJ,OAAf,CAAuB9B,OAAvB,CAAJ,EAAqC;AACnCyD,sBAAAA,OAAO,CAACtM,IAAR,CAAaiM,UAAU,CAACxL,GAAD,CAAvB;AACD;AACF;;AAED,yBAAO6L,OAAP;AACD,iBAXkC,EAWhC,EAXgC,CAA5B,CAAP;;AAaF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOH,UAAU,CAAChJ,IAAX,EAAP;AA9BJ;AAgCD;AACF,SAnCM,EAmCJ6I,SAnCI,EAmCO,IAnCP,CAAP;AAoCD,OAtCD,CAFyB,CAAzB;;AA0CA,eAASO,iBAAT,GAA6B;AAC3B,eAAOR,kBAAkB,CAAC9L,KAAnB,CAAyB,IAAzB,EAA+BI,SAA/B,CAAP;AACD;;AAED,aAAOkM,iBAAP;AACD,KAhDM;AAFN,GA7hBkC,EAglBlC;AACD9L,IAAAA,GAAG,EAAE,KADJ;AAEDmF,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,aAAO,KAAKgD,IAAL,CAAU4D,GAAjB;AACD;AACD;;;;AALC,GAhlBkC,EAylBlC;AACD/L,IAAAA,GAAG,EAAE,MADJ;AAEDmF,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,UAAI,CAAC,KAAKnC,IAAV,EAAgB,MAAM,IAAI6F,KAAJ,CAAU,2BAAV,CAAN;AAChB,WAAKmD,KAAL,GAAa,KAAKA,KAAL,IAAc,IAAInJ,IAAJ,CAAS,KAAKE,KAAd,EAAqB,KAAKC,IAA1B,CAA3B;AACA,aAAO,KAAKgJ,KAAZ;AACD;AANA,GAzlBkC,EAgmBlC;AACDhM,IAAAA,GAAG,EAAE,QADJ;AAEDmF,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,aAAO8G,OAAO,CAAC,KAAKzG,MAAL,CAAY0G,GAAb,CAAd;AACD;AAJA,GAhmBkC,CAArC;AAsmBA,SAAO7G,KAAP;AACD,CAloBD,EAFA;;AAsoBA8G,MAAM,CAACC,OAAP,GAAiB/G,KAAjB;;AAEA,IAAIyB,kBAAkB,GAAG,SAASA,kBAAT,CAA4BuF,KAA5B,EAAmC;AAC1D,MAAIC,MAAM,GAAG,MAAb;AACA,SAAO;AACLnH,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIoH,IAAI,GAAG,CAAC,GAAG5N,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASiL,SAAT,CAAmBxM,GAAnB,EAAwB;AACnD,YAAIqD,IAAJ;AAAA,YACIoJ,OAAO,GAAG7M,SADd;AAEA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS8K,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC5K,IAAX,GAAkB4K,UAAU,CAAC3K,IAArC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAGoJ,OAAO,CAAC5M,MAAR,GAAiB,CAAjB,IAAsB4M,OAAO,CAAC,CAAD,CAAP,KAAehJ,SAArC,GAAiDgJ,OAAO,CAAC,CAAD,CAAxD,GAA8D,EAArE;AACA,uBAAOE,UAAU,CAACnK,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAAClH,GAAN,CAAUmH,MAAM,GAAGtM,GAAnB,EAAwBqD,IAAxB,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOsJ,UAAU,CAACjK,IAAX,EAAP;AAPJ;AASD;AACF,SAZM,EAYJ8J,SAZI,CAAP;AAaD,OAhBD,CAFW,CAAX;;AAoBA,eAASrH,GAAT,CAAayH,IAAb,EAAmB;AACjB,eAAOL,IAAI,CAAC/M,KAAL,CAAW,IAAX,EAAiBI,SAAjB,CAAP;AACD;;AAED,aAAOuF,GAAP;AACD,KA1BI,EADA;AA4BL0H,IAAAA,WAAW,EAAE,YAAY;AACvB,UAAIC,YAAY,GAAG,CAAC,GAAGnO,kBAAkB,CAAC,SAAD,CAAtB,GACnB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASwL,SAAT,CAAmB/M,GAAnB,EAAwB;AACnD,eAAOtB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASoL,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAClL,IAAX,GAAkBkL,UAAU,CAACjL,IAArC;AACE,mBAAK,CAAL;AACE,uBAAOiL,UAAU,CAACzK,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAACQ,WAAN,CAAkBP,MAAM,GAAGtM,GAA3B,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOiN,UAAU,CAACvK,IAAX,EAAP;AANJ;AAQD;AACF,SAXM,EAWJqK,SAXI,CAAP;AAYD,OAbD,CAFmB,CAAnB;;AAiBA,eAASF,WAAT,CAAqBK,IAArB,EAA2B;AACzB,eAAOJ,YAAY,CAACtN,KAAb,CAAmB,IAAnB,EAAyBI,SAAzB,CAAP;AACD;;AAED,aAAOiN,WAAP;AACD,KAvBY,EA5BR;AAoDLhC,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIsC,IAAI,GAAG,CAAC,GAAGxO,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS6L,SAAT,CAAmBpN,GAAnB,EAAwBiD,KAAxB,EAA+B;AAC1D,eAAOvE,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASyL,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACvL,IAAX,GAAkBuL,UAAU,CAACtL,IAArC;AACE,mBAAK,CAAL;AACEvB,gBAAAA,gBAAgB,CAACT,GAAD,EAAM,KAAN,CAAhB;AACA,uBAAOsN,UAAU,CAAC9K,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAACxB,GAAN,CAAUyB,MAAM,GAAGtM,GAAnB,EAAwBiD,KAAxB,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOqK,UAAU,CAAC5K,IAAX,EAAP;AAPJ;AASD;AACF,SAZM,EAYJ0K,SAZI,CAAP;AAaD,OAdD,CAFW,CAAX;;AAkBA,eAASvC,GAAT,CAAa0C,IAAb,EAAmBC,IAAnB,EAAyB;AACvB,eAAOL,IAAI,CAAC3N,KAAL,CAAW,IAAX,EAAiBI,SAAjB,CAAP;AACD;;AAED,aAAOiL,GAAP;AACD,KAxBI,EApDA;AA6EL4C,IAAAA,WAAW,EAAE,YAAY;AACvB,UAAIC,YAAY,GAAG,CAAC,GAAG/O,kBAAkB,CAAC,SAAD,CAAtB,GACnB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASoM,SAAT,CAAmB5O,IAAnB,EAAyB0I,MAAzB,EAAiC;AAC5D,YAAImG,YAAJ;AACA,eAAOlP,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASiM,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC/L,IAAX,GAAkB+L,UAAU,CAAC9L,IAArC;AACE,mBAAK,CAAL;AACEtB,gBAAAA,wBAAwB,CAAC3B,IAAD,EAAO0I,MAAP,CAAxB;AACAmG,gBAAAA,YAAY,GAAG7O,IAAI,CAACgP,GAAL,CAAS,UAAU/N,GAAV,EAAe;AACrC,yBAAOsM,MAAM,GAAGtM,GAAhB;AACD,iBAFc,CAAf;AAGA,uBAAO8N,UAAU,CAACtL,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAACoB,WAAN,CAAkBG,YAAlB,EAAgCnG,MAAhC,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOqG,UAAU,CAACpL,IAAX,EAAP;AAVJ;AAYD;AACF,SAfM,EAeJiL,SAfI,CAAP;AAgBD,OAlBD,CAFmB,CAAnB;;AAsBA,eAASF,WAAT,CAAqBO,IAArB,EAA2BC,IAA3B,EAAiC;AAC/B,eAAOP,YAAY,CAAClO,KAAb,CAAmB,IAAnB,EAAyBI,SAAzB,CAAP;AACD;;AAED,aAAO6N,WAAP;AACD,KA5BY,EA7ER;AA0GLtC,IAAAA,MAAM,EAAE,YAAY;AAClB,UAAI+C,OAAO,GAAG,CAAC,GAAGvP,kBAAkB,CAAC,SAAD,CAAtB,GACd,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS4M,SAAT,CAAmBnO,GAAnB,EAAwB;AACnD,eAAOtB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASwM,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACtM,IAAX,GAAkBsM,UAAU,CAACrM,IAArC;AACE,mBAAK,CAAL;AACEvB,gBAAAA,gBAAgB,CAACT,GAAD,EAAM,KAAN,CAAhB;AACA,uBAAOqO,UAAU,CAAC7L,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAAClB,MAAN,CAAamB,MAAM,GAAGtM,GAAtB,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOqO,UAAU,CAAC3L,IAAX,EAAP;AAPJ;AASD;AACF,SAZM,EAYJyL,SAZI,CAAP;AAaD,OAdD,CAFc,CAAd;;AAkBA,eAAShD,MAAT,CAAgBmD,IAAhB,EAAsB;AACpB,eAAOJ,OAAO,CAAC1O,KAAR,CAAc,IAAd,EAAoBI,SAApB,CAAP;AACD;;AAED,aAAOuL,MAAP;AACD,KAxBO,EA1GH;AAmILoD,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIC,IAAI,GAAG,CAAC,GAAG7P,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASkN,SAAT,GAAqB;AAChD,eAAO/P,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS8M,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC5M,IAAX,GAAkB4M,UAAU,CAAC3M,IAArC;AACE,mBAAK,CAAL;AACE2M,gBAAAA,UAAU,CAAC3M,IAAX,GAAkB,CAAlB;AACA,uBAAOqK,KAAK,CAACkC,GAAN,EAAP;;AAEF,mBAAK,CAAL;AACEI,gBAAAA,UAAU,CAAC1F,EAAX,GAAgB,UAAU2F,MAAV,EAAkBC,KAAlB,EAAyB;AACvC,sBAAIA,KAAK,CAAC7O,GAAN,CAAUiC,UAAV,CAAqBqK,MAArB,CAAJ,EAAkC;AAChCuC,oBAAAA,KAAK,CAAC7O,GAAN,GAAY6O,KAAK,CAAC7O,GAAN,CAAU8O,KAAV,CAAgB,CAAhB,CAAZ;AACAF,oBAAAA,MAAM,CAACrP,IAAP,CAAYsP,KAAZ;AACD;;AAED,yBAAOD,MAAP;AACD,iBAPD;;AASAD,gBAAAA,UAAU,CAACzF,EAAX,GAAgB,EAAhB;AACA,uBAAOyF,UAAU,CAACnM,MAAX,CAAkB,QAAlB,EAA4BmM,UAAU,CAACxM,IAAX,CAAgByJ,MAAhB,CAAuB+C,UAAU,CAAC1F,EAAlC,EAAsC0F,UAAU,CAACzF,EAAjD,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOyF,UAAU,CAACjM,IAAX,EAAP;AApBJ;AAsBD;AACF,SAzBM,EAyBJ+L,SAzBI,CAAP;AA0BD,OA3BD,CAFW,CAAX;;AA+BA,eAASF,GAAT,GAAe;AACb,eAAOC,IAAI,CAAChP,KAAL,CAAW,IAAX,EAAiBI,SAAjB,CAAP;AACD;;AAED,aAAO2O,GAAP;AACD,KArCI,EAnIA;AAyKL5C,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIoD,IAAI,GAAG,CAAC,GAAGpQ,kBAAkB,CAAC,SAAD,CAAtB,GACX,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyN,SAAT,CAAmB3L,IAAnB,EAAyB;AACpD,YAAI4L,OAAJ;AACA,eAAOvQ,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASsN,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACpN,IAAX,GAAkBoN,UAAU,CAACnN,IAArC;AACE,mBAAK,CAAL;AACEmN,gBAAAA,UAAU,CAACnN,IAAX,GAAkB,CAAlB;AACA,uBAAOqK,KAAK,CAACV,GAAN,CAAUtI,IAAV,CAAP;;AAEF,mBAAK,CAAL;AACE4L,gBAAAA,OAAO,GAAGE,UAAU,CAAChN,IAArB;AACA,uBAAOgN,UAAU,CAAC3M,MAAX,CAAkB,QAAlB,EAA4BxD,MAAM,CAACD,IAAP,CAAYkQ,OAAZ,EAAqBrD,MAArB,CAA4B,UAAUwD,MAAV,EAAkBpP,GAAlB,EAAuB;AACpF,sBAAIA,GAAG,CAACiC,UAAJ,CAAeqK,MAAf,CAAJ,EAA4B;AAC1B8C,oBAAAA,MAAM,CAACpP,GAAG,CAAC8O,KAAJ,CAAU,CAAV,CAAD,CAAN,GAAuBG,OAAO,CAACjP,GAAD,CAA9B;AACD;;AAED,yBAAOoP,MAAP;AACD,iBANkC,EAMhC,EANgC,CAA5B,CAAP;;AAQF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOD,UAAU,CAACzM,IAAX,EAAP;AAjBJ;AAmBD;AACF,SAtBM,EAsBJsM,SAtBI,CAAP;AAuBD,OAzBD,CAFW,CAAX;;AA6BA,eAASrD,GAAT,CAAa0D,IAAb,EAAmB;AACjB,eAAON,IAAI,CAACvP,KAAL,CAAW,IAAX,EAAiBI,SAAjB,CAAP;AACD;;AAED,aAAO+L,GAAP;AACD,KAnCI;AAzKA,GAAP;AA8MD,CAhND;;AAkNA,IAAI5E,mBAAmB,GAAG,SAASA,mBAAT,CAA6BsF,KAA7B,EAAoCvJ,OAApC,EAA6C7B,SAA7C,EAAwD;AAChF,MAAIqL,MAAM,GAAG,OAAb;;AAEA,MAAIgD,KAAK,GACT,aACA,YAAY;AACV,QAAIC,KAAK,GAAG,CAAC,GAAG5Q,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASiO,SAAT,CAAmBxP,GAAnB,EAAwB;AACnD,aAAOtB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS6N,UAAT,CAAoBC,UAApB,EAAgC;AAClE,eAAO,CAAP,EAAU;AACR,kBAAQA,UAAU,CAAC3N,IAAX,GAAkB2N,UAAU,CAAC1N,IAArC;AACE,iBAAK,CAAL;AACEvB,cAAAA,gBAAgB,CAACT,GAAD,EAAM,KAAN,CAAhB;AACA0P,cAAAA,UAAU,CAACzG,EAAX,GAAgBqD,MAAhB;AACAoD,cAAAA,UAAU,CAAC1N,IAAX,GAAkB,CAAlB;AACA,qBAAOc,OAAO,CAAC6M,SAAR,CAAkB3P,GAAlB,EAAuBiB,SAAvB,CAAP;;AAEF,iBAAK,CAAL;AACEyO,cAAAA,UAAU,CAACxG,EAAX,GAAgBwG,UAAU,CAACvN,IAA3B;AACA,qBAAOuN,UAAU,CAAClN,MAAX,CAAkB,QAAlB,EAA4BkN,UAAU,CAACzG,EAAX,GAAgByG,UAAU,CAACxG,EAAvD,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOwG,UAAU,CAAChN,IAAX,EAAP;AAbJ;AAeD;AACF,OAlBM,EAkBJ8M,SAlBI,CAAP;AAmBD,KApBD,CAFY,CAAZ;;AAwBA,WAAO,SAASF,KAAT,CAAeM,IAAf,EAAqB;AAC1B,aAAOL,KAAK,CAAC/P,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD,KAFD;AAGD,GA5BD,EAFA;;AAgCA,MAAIiQ,YAAY,GAChB,aACA,YAAY;AACV,QAAIC,KAAK,GAAG,CAAC,GAAGnR,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASwO,SAAT,CAAmBlB,KAAnB,EAA0B;AACrD,aAAOnQ,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASoO,UAAT,CAAoBC,UAApB,EAAgC;AAClE,eAAO,CAAP,EAAU;AACR,kBAAQA,UAAU,CAAClO,IAAX,GAAkBkO,UAAU,CAACjO,IAArC;AACE,iBAAK,CAAL;AACE,qBAAOiO,UAAU,CAACzN,MAAX,CAAkB,QAAlB,EAA4BM,OAAO,CAAC0B,OAAR,CAAgB0L,IAAI,CAACC,SAAL,CAAetB,KAAf,CAAhB,EAAuC5N,SAAvC,CAA5B,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOgP,UAAU,CAACvN,IAAX,EAAP;AANJ;AAQD;AACF,OAXM,EAWJqN,SAXI,CAAP;AAYD,KAbD,CAFY,CAAZ;;AAiBA,WAAO,SAASF,YAAT,CAAsBO,IAAtB,EAA4B;AACjC,aAAON,KAAK,CAACtQ,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD,KAFD;AAGD,GArBD,EAFA;;AAyBA,MAAIyQ,YAAY,GAChB,aACA,YAAY;AACV,QAAIC,KAAK,GAAG,CAAC,GAAG3R,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASgP,SAAT,CAAmBC,MAAnB,EAA2B;AACtD,aAAO9R,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS6O,UAAT,CAAoBC,UAApB,EAAgC;AAClE,eAAO,CAAP,EAAU;AACR,kBAAQA,UAAU,CAAC3O,IAAX,GAAkB2O,UAAU,CAAC1O,IAArC;AACE,iBAAK,CAAL;AACE0O,cAAAA,UAAU,CAACzH,EAAX,GAAgBiH,IAAhB;AACAQ,cAAAA,UAAU,CAAC1O,IAAX,GAAkB,CAAlB;AACA,qBAAOc,OAAO,CAACkC,OAAR,CAAgBwL,MAAhB,EAAwBvP,SAAxB,CAAP;;AAEF,iBAAK,CAAL;AACEyP,cAAAA,UAAU,CAACxH,EAAX,GAAgBwH,UAAU,CAACvO,IAA3B;AACA,qBAAOuO,UAAU,CAAClO,MAAX,CAAkB,QAAlB,EAA4BkO,UAAU,CAACzH,EAAX,CAAc0H,KAAd,CAAoBxH,IAApB,CAAyBuH,UAAU,CAACzH,EAApC,EAAwCyH,UAAU,CAACxH,EAAnD,CAA5B,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOwH,UAAU,CAAChO,IAAX,EAAP;AAZJ;AAcD;AACF,OAjBM,EAiBJ6N,SAjBI,CAAP;AAkBD,KAnBD,CAFY,CAAZ;;AAuBA,WAAO,SAASF,YAAT,CAAsBO,IAAtB,EAA4B;AACjC,aAAON,KAAK,CAAC9Q,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD,KAFD;AAGD,GA3BD,EAFA;;AA+BA,SAAO;AACLuF,IAAAA,GAAG,EAAE,YAAY;AACf,UAAI0L,KAAK,GAAG,CAAC,GAAGlS,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASuP,SAAT,CAAmB9Q,GAAnB,EAAwB;AACnD,YAAIqD,IAAJ;AAAA,YACIwL,KADJ;AAAA,YAEIkC,OAAO,GAAGnR,SAFd;AAGA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASoP,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAClP,IAAX,GAAkBkP,UAAU,CAACjP,IAArC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAG0N,OAAO,CAAClR,MAAR,GAAiB,CAAjB,IAAsBkR,OAAO,CAAC,CAAD,CAAP,KAAetN,SAArC,GAAiDsN,OAAO,CAAC,CAAD,CAAxD,GAA8D,EAArE;AACAE,gBAAAA,UAAU,CAAChI,EAAX,GAAgBoD,KAAhB;AACA4E,gBAAAA,UAAU,CAACjP,IAAX,GAAkB,CAAlB;AACA,uBAAOsN,KAAK,CAACtP,GAAD,CAAZ;;AAEF,mBAAK,CAAL;AACEiR,gBAAAA,UAAU,CAAC/H,EAAX,GAAgB+H,UAAU,CAAC9O,IAA3B;AACA8O,gBAAAA,UAAU,CAACC,EAAX,GAAgB7N,IAAhB;AACA4N,gBAAAA,UAAU,CAACjP,IAAX,GAAkB,CAAlB;AACA,uBAAOiP,UAAU,CAAChI,EAAX,CAAc9D,GAAd,CAAkBgE,IAAlB,CAAuB8H,UAAU,CAAChI,EAAlC,EAAsCgI,UAAU,CAAC/H,EAAjD,EAAqD+H,UAAU,CAACC,EAAhE,CAAP;;AAEF,mBAAK,CAAL;AACErC,gBAAAA,KAAK,GAAGoC,UAAU,CAAC9O,IAAnB;;AAEA,oBAAI0M,KAAJ,EAAW;AACToC,kBAAAA,UAAU,CAACjP,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED,uBAAOiP,UAAU,CAACzO,MAAX,CAAkB,QAAlB,EAA4B,IAA5B,CAAP;;AAEF,mBAAK,EAAL;AACE,oBAAI,CAACa,IAAI,CAAC8N,QAAV,EAAoB;AAClBF,kBAAAA,UAAU,CAACjP,IAAX,GAAkB,EAAlB;AACA;AACD;;AAEDiP,gBAAAA,UAAU,CAACG,EAAX,GAAgB3R,aAAhB;AACAwR,gBAAAA,UAAU,CAACI,EAAX,GAAgB,EAAhB;AACAJ,gBAAAA,UAAU,CAACK,EAAX,GAAgBzC,KAAhB;AACAoC,gBAAAA,UAAU,CAACjP,IAAX,GAAkB,EAAlB;AACA,uBAAOqO,YAAY,CAACxB,KAAK,CAAC5L,KAAP,CAAnB;;AAEF,mBAAK,EAAL;AACEgO,gBAAAA,UAAU,CAACM,EAAX,GAAgBN,UAAU,CAAC9O,IAAX,CAAgBc,KAAhC;AACAgO,gBAAAA,UAAU,CAACO,EAAX,GAAgB;AACdvO,kBAAAA,KAAK,EAAEgO,UAAU,CAACM;AADJ,iBAAhB;AAGA,uBAAON,UAAU,CAACzO,MAAX,CAAkB,QAAlB,EAA4B,CAAC,GAAGyO,UAAU,CAACG,EAAf,EAAmBH,UAAU,CAACI,EAA9B,EAAkCJ,UAAU,CAACK,EAA7C,EAAiDL,UAAU,CAACO,EAA5D,CAA5B,CAAP;;AAEF,mBAAK,EAAL;AACEP,gBAAAA,UAAU,CAACjP,IAAX,GAAkB,EAAlB;AACA,uBAAOqO,YAAY,CAACxB,KAAD,CAAnB;;AAEF,mBAAK,EAAL;AACE,uBAAOoC,UAAU,CAACzO,MAAX,CAAkB,QAAlB,EAA4ByO,UAAU,CAAC9O,IAAX,CAAgBc,KAA5C,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOgO,UAAU,CAACvO,IAAX,EAAP;AAnDJ;AAqDD;AACF,SAxDM,EAwDJoO,SAxDI,CAAP;AAyDD,OA7DD,CAFY,CAAZ;;AAiEA,eAAS3L,GAAT,CAAasM,IAAb,EAAmB;AACjB,eAAOZ,KAAK,CAACrR,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD;;AAED,aAAOuF,GAAP;AACD,KAvEI,EADA;AAyEL0H,IAAAA,WAAW,EAAE,YAAY;AACvB,UAAI6E,aAAa,GAAG,CAAC,GAAG/S,kBAAkB,CAAC,SAAD,CAAtB,GACpB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASoQ,SAAT,CAAmB3R,GAAnB,EAAwB;AACnD,eAAOtB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASgQ,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC9P,IAAX,GAAkB8P,UAAU,CAAC7P,IAArC;AACE,mBAAK,CAAL;AACE6P,gBAAAA,UAAU,CAAC5I,EAAX,GAAgBoD,KAAhB;AACAwF,gBAAAA,UAAU,CAAC7P,IAAX,GAAkB,CAAlB;AACA,uBAAOsN,KAAK,CAACtP,GAAD,CAAZ;;AAEF,mBAAK,CAAL;AACE6R,gBAAAA,UAAU,CAAC3I,EAAX,GAAgB2I,UAAU,CAAC1P,IAA3B;AACA,uBAAO0P,UAAU,CAACrP,MAAX,CAAkB,QAAlB,EAA4BqP,UAAU,CAAC5I,EAAX,CAAc4D,WAAd,CAA0B1D,IAA1B,CAA+B0I,UAAU,CAAC5I,EAA1C,EAA8C4I,UAAU,CAAC3I,EAAzD,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAO2I,UAAU,CAACnP,IAAX,EAAP;AAZJ;AAcD;AACF,SAjBM,EAiBJiP,SAjBI,CAAP;AAkBD,OAnBD,CAFoB,CAApB;;AAuBA,eAAS9E,WAAT,CAAqBiF,IAArB,EAA2B;AACzB,eAAOJ,aAAa,CAAClS,KAAd,CAAoB,IAApB,EAA0BI,SAA1B,CAAP;AACD;;AAED,aAAOiN,WAAP;AACD,KA7BY,EAzER;AAuGLhC,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIkH,KAAK,GAAG,CAAC,GAAGpT,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyQ,SAAT,CAAmBhS,GAAnB,EAAwBiD,KAAxB,EAA+B;AAC1D,eAAOvE,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASqQ,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACnQ,IAAX,GAAkBmQ,UAAU,CAAClQ,IAArC;AACE,mBAAK,CAAL;AACEkQ,gBAAAA,UAAU,CAACjJ,EAAX,GAAgBoD,KAAhB;AACA6F,gBAAAA,UAAU,CAAClQ,IAAX,GAAkB,CAAlB;AACA,uBAAOsN,KAAK,CAACtP,GAAD,CAAZ;;AAEF,mBAAK,CAAL;AACEkS,gBAAAA,UAAU,CAAChJ,EAAX,GAAgBgJ,UAAU,CAAC/P,IAA3B;AACA+P,gBAAAA,UAAU,CAAClQ,IAAX,GAAkB,CAAlB;AACA,uBAAO6N,YAAY,CAAC;AAClB7P,kBAAAA,GAAG,EAAEA,GADa;AAElBiD,kBAAAA,KAAK,EAAEA;AAFW,iBAAD,CAAnB;;AAKF,mBAAK,CAAL;AACEiP,gBAAAA,UAAU,CAAChB,EAAX,GAAgBgB,UAAU,CAAC/P,IAA3B;AACA,uBAAO+P,UAAU,CAAC1P,MAAX,CAAkB,QAAlB,EAA4B0P,UAAU,CAACjJ,EAAX,CAAc4B,GAAd,CAAkB1B,IAAlB,CAAuB+I,UAAU,CAACjJ,EAAlC,EAAsCiJ,UAAU,CAAChJ,EAAjD,EAAqDgJ,UAAU,CAAChB,EAAhE,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOgB,UAAU,CAACxP,IAAX,EAAP;AApBJ;AAsBD;AACF,SAzBM,EAyBJsP,SAzBI,CAAP;AA0BD,OA3BD,CAFY,CAAZ;;AA+BA,eAASnH,GAAT,CAAasH,IAAb,EAAmBC,IAAnB,EAAyB;AACvB,eAAOL,KAAK,CAACvS,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD;;AAED,aAAOiL,GAAP;AACD,KArCI,EAvGA;AA6IL4C,IAAAA,WAAW,EAAE,YAAY;AACvB,UAAI4E,aAAa,GAAG,CAAC,GAAG1T,kBAAkB,CAAC,SAAD,CAAtB,GACpB,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS+Q,SAAT,CAAmBvT,IAAnB,EAAyB0I,MAAzB,EAAiC;AAC5D,YAAI8K,MAAJ,EAAYC,gBAAZ;AACA,eAAO9T,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS6Q,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC3Q,IAAX,GAAkB2Q,UAAU,CAAC1Q,IAArC;AACE,mBAAK,CAAL;AACEtB,gBAAAA,wBAAwB,CAAC3B,IAAD,EAAO0I,MAAP,CAAxB;AACAiL,gBAAAA,UAAU,CAAC1Q,IAAX,GAAkB,CAAlB;AACA,uBAAO2Q,OAAO,CAAChH,GAAR,CAAY5M,IAAI,CAACgP,GAAL,CAASuB,KAAT,CAAZ,CAAP;;AAEF,mBAAK,CAAL;AACEiD,gBAAAA,MAAM,GAAGG,UAAU,CAACvQ,IAApB;AACAuQ,gBAAAA,UAAU,CAAC1Q,IAAX,GAAkB,CAAlB;AACA,uBAAO2Q,OAAO,CAAChH,GAAR,CAAYlE,MAAM,CAACsG,GAAP,CAAW,UAAU9K,KAAV,EAAiB2P,KAAjB,EAAwB;AACpD,yBAAO/C,YAAY,CAAC;AAClB7P,oBAAAA,GAAG,EAAEjB,IAAI,CAAC6T,KAAD,CADS;AAElB3P,oBAAAA,KAAK,EAAEA;AAFW,mBAAD,CAAnB;AAID,iBALkB,CAAZ,CAAP;;AAOF,mBAAK,CAAL;AACEuP,gBAAAA,gBAAgB,GAAGE,UAAU,CAACvQ,IAA9B;AACA,uBAAOuQ,UAAU,CAAClQ,MAAX,CAAkB,QAAlB,EAA4B6J,KAAK,CAACoB,WAAN,CAAkB8E,MAAlB,EAA0BC,gBAA1B,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOE,UAAU,CAAChQ,IAAX,EAAP;AAtBJ;AAwBD;AACF,SA3BM,EA2BJ4P,SA3BI,CAAP;AA4BD,OA9BD,CAFoB,CAApB;;AAkCA,eAAS7E,WAAT,CAAqBoF,IAArB,EAA2BC,IAA3B,EAAiC;AAC/B,eAAOT,aAAa,CAAC7S,KAAd,CAAoB,IAApB,EAA0BI,SAA1B,CAAP;AACD;;AAED,aAAO6N,WAAP;AACD,KAxCY,EA7IR;AAsLLtC,IAAAA,MAAM,EAAE,YAAY;AAClB,UAAI4H,QAAQ,GAAG,CAAC,GAAGpU,kBAAkB,CAAC,SAAD,CAAtB,GACf,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAASyR,SAAT,CAAmBhT,GAAnB,EAAwB;AACnD,eAAOtB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASqR,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAACnR,IAAX,GAAkBmR,UAAU,CAAClR,IAArC;AACE,mBAAK,CAAL;AACEkR,gBAAAA,UAAU,CAACjK,EAAX,GAAgBoD,KAAhB;AACA6G,gBAAAA,UAAU,CAAClR,IAAX,GAAkB,CAAlB;AACA,uBAAOsN,KAAK,CAACtP,GAAD,CAAZ;;AAEF,mBAAK,CAAL;AACEkT,gBAAAA,UAAU,CAAChK,EAAX,GAAgBgK,UAAU,CAAC/Q,IAA3B;AACA,uBAAO+Q,UAAU,CAAC1Q,MAAX,CAAkB,QAAlB,EAA4B0Q,UAAU,CAACjK,EAAX,CAAckC,MAAd,CAAqBhC,IAArB,CAA0B+J,UAAU,CAACjK,EAArC,EAAyCiK,UAAU,CAAChK,EAApD,CAA5B,CAAP;;AAEF,mBAAK,CAAL;AACA,mBAAK,KAAL;AACE,uBAAOgK,UAAU,CAACxQ,IAAX,EAAP;AAZJ;AAcD;AACF,SAjBM,EAiBJsQ,SAjBI,CAAP;AAkBD,OAnBD,CAFe,CAAf;;AAuBA,eAAS7H,MAAT,CAAgBgI,IAAhB,EAAsB;AACpB,eAAOJ,QAAQ,CAACvT,KAAT,CAAe,IAAf,EAAqBI,SAArB,CAAP;AACD;;AAED,aAAOuL,MAAP;AACD,KA7BO,EAtLH;AAoNLoD,IAAAA,GAAG,EAAE,YAAY;AACf,UAAI6E,KAAK,GAAG,CAAC,GAAGzU,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS8R,SAAT,GAAqB;AAChD,YAAI9E,GAAJ,EAAS+E,OAAT,EAAkBC,yBAAlB,EAA6CC,iBAA7C,EAAgEC,cAAhE,EAAgFC,SAAhF,EAA2FC,KAA3F,EAAkG9E,KAAlG,EAAyG+E,QAAzG;;AAEA,eAAOlV,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAASiS,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC/R,IAAX,GAAkB+R,UAAU,CAAC9R,IAArC;AACE,mBAAK,CAAL;AACE8R,gBAAAA,UAAU,CAAC9R,IAAX,GAAkB,CAAlB;AACA,uBAAOqK,KAAK,CAACkC,GAAN,EAAP;;AAEF,mBAAK,CAAL;AACEA,gBAAAA,GAAG,GAAGuF,UAAU,CAAC3R,IAAjB;AACAmR,gBAAAA,OAAO,GAAG,EAAV;AACAC,gBAAAA,yBAAyB,GAAG,IAA5B;AACAC,gBAAAA,iBAAiB,GAAG,KAApB;AACAC,gBAAAA,cAAc,GAAGhQ,SAAjB;AACAqQ,gBAAAA,UAAU,CAAC/R,IAAX,GAAkB,CAAlB;AACA2R,gBAAAA,SAAS,GAAGnF,GAAG,CAACwF,MAAM,CAACC,QAAR,CAAH,EAAZ;;AAEF,mBAAK,CAAL;AACE,oBAAIT,yBAAyB,GAAG,CAACI,KAAK,GAAGD,SAAS,CAAC1R,IAAV,EAAT,EAA2BiS,IAA3D,EAAiE;AAC/DH,kBAAAA,UAAU,CAAC9R,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED6M,gBAAAA,KAAK,GAAG8E,KAAK,CAAC1Q,KAAd;;AAEA,oBAAI,CAAC4L,KAAK,CAAC7O,GAAN,CAAUiC,UAAV,CAAqBqK,MAArB,CAAL,EAAmC;AACjCwH,kBAAAA,UAAU,CAAC9R,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED8R,gBAAAA,UAAU,CAAC9R,IAAX,GAAkB,EAAlB;AACA,uBAAOqO,YAAY,CAACxB,KAAK,CAAC5L,KAAP,CAAnB;;AAEF,mBAAK,EAAL;AACE2Q,gBAAAA,QAAQ,GAAGE,UAAU,CAAC3R,IAAtB;AACA0M,gBAAAA,KAAK,CAAC7O,GAAN,GAAY4T,QAAQ,CAAC5T,GAArB;AACA6O,gBAAAA,KAAK,CAAC5L,KAAN,GAAc2Q,QAAQ,CAAC3Q,KAAvB;AACAqQ,gBAAAA,OAAO,CAAC/T,IAAR,CAAasP,KAAb;;AAEF,mBAAK,EAAL;AACE0E,gBAAAA,yBAAyB,GAAG,IAA5B;AACAO,gBAAAA,UAAU,CAAC9R,IAAX,GAAkB,CAAlB;AACA;;AAEF,mBAAK,EAAL;AACE8R,gBAAAA,UAAU,CAAC9R,IAAX,GAAkB,EAAlB;AACA;;AAEF,mBAAK,EAAL;AACE8R,gBAAAA,UAAU,CAAC/R,IAAX,GAAkB,EAAlB;AACA+R,gBAAAA,UAAU,CAAC7K,EAAX,GAAgB6K,UAAU,CAAC,OAAD,CAAV,CAAoB,CAApB,CAAhB;AACAN,gBAAAA,iBAAiB,GAAG,IAApB;AACAC,gBAAAA,cAAc,GAAGK,UAAU,CAAC7K,EAA5B;;AAEF,mBAAK,EAAL;AACE6K,gBAAAA,UAAU,CAAC/R,IAAX,GAAkB,EAAlB;AACA+R,gBAAAA,UAAU,CAAC/R,IAAX,GAAkB,EAAlB;;AAEA,oBAAI,CAACwR,yBAAD,IAA8BG,SAAS,CAAC,QAAD,CAAT,IAAuB,IAAzD,EAA+D;AAC7DA,kBAAAA,SAAS,CAAC,QAAD,CAAT;AACD;;AAEH,mBAAK,EAAL;AACEI,gBAAAA,UAAU,CAAC/R,IAAX,GAAkB,EAAlB;;AAEA,oBAAI,CAACyR,iBAAL,EAAwB;AACtBM,kBAAAA,UAAU,CAAC9R,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED,sBAAMyR,cAAN;;AAEF,mBAAK,EAAL;AACE,uBAAOK,UAAU,CAACI,MAAX,CAAkB,EAAlB,CAAP;;AAEF,mBAAK,EAAL;AACE,uBAAOJ,UAAU,CAACI,MAAX,CAAkB,EAAlB,CAAP;;AAEF,mBAAK,EAAL;AACE,uBAAOJ,UAAU,CAACtR,MAAX,CAAkB,QAAlB,EAA4B8Q,OAA5B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOQ,UAAU,CAACpR,IAAX,EAAP;AAhFJ;AAkFD;AACF,SArFM,EAqFJ2Q,SArFI,EAqFO,IArFP,EAqFa,CAAC,CAAC,CAAD,EAAI,EAAJ,EAAQ,EAAR,EAAY,EAAZ,CAAD,EAAkB,CAAC,EAAD,GAAM,EAAN,EAAU,EAAV,CAAlB,CArFb,CAAP;AAsFD,OAzFD,CAFY,CAAZ;;AA6FA,eAAS9E,GAAT,GAAe;AACb,eAAO6E,KAAK,CAAC5T,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD;;AAED,aAAO2O,GAAP;AACD,KAnGI,EApNA;AAwTL5C,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIwI,KAAK,GAAG,CAAC,GAAGxV,kBAAkB,CAAC,SAAD,CAAtB,GACZ,aACAD,YAAY,CAAC,SAAD,CAAZ,CAAwB6C,IAAxB,CAA6B,SAAS6S,SAAT,GAAqB;AAChD,YAAI/Q,IAAJ;AAAA,YACI4L,OADJ;AAAA,YAEIoF,WAFJ;AAAA,YAGIrU,GAHJ;AAAA,YAII6O,KAJJ;AAAA,YAKI+E,QALJ;AAAA,YAMIU,SANJ;AAAA,YAOIC,OAAO,GAAG3U,SAPd;;AASA,eAAOlB,YAAY,CAAC,SAAD,CAAZ,CAAwBkD,IAAxB,CAA6B,SAAS4S,UAAT,CAAoBC,UAApB,EAAgC;AAClE,iBAAO,CAAP,EAAU;AACR,oBAAQA,UAAU,CAAC1S,IAAX,GAAkB0S,UAAU,CAACzS,IAArC;AACE,mBAAK,CAAL;AACEqB,gBAAAA,IAAI,GAAGkR,OAAO,CAAC1U,MAAR,GAAiB,CAAjB,IAAsB0U,OAAO,CAAC,CAAD,CAAP,KAAe9Q,SAArC,GAAiD8Q,OAAO,CAAC,CAAD,CAAxD,GAA8D,EAArE;AACAE,gBAAAA,UAAU,CAACzS,IAAX,GAAkB,CAAlB;AACA,uBAAOqK,KAAK,CAACV,GAAN,CAAUtI,IAAV,CAAP;;AAEF,mBAAK,CAAL;AACE4L,gBAAAA,OAAO,GAAGwF,UAAU,CAACtS,IAArB;AACAkS,gBAAAA,WAAW,GAAG,EAAd;AACAI,gBAAAA,UAAU,CAACxL,EAAX,GAAgBvK,YAAY,CAAC,SAAD,CAAZ,CAAwBK,IAAxB,CAA6BkQ,OAA7B,CAAhB;;AAEF,mBAAK,CAAL;AACE,oBAAI,CAACwF,UAAU,CAACvL,EAAX,GAAgBuL,UAAU,CAACxL,EAAX,EAAjB,EAAkCgL,IAAtC,EAA4C;AAC1CQ,kBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA;AACD;;AAEDhC,gBAAAA,GAAG,GAAGyU,UAAU,CAACvL,EAAX,CAAcjG,KAApB;;AAEA,oBAAI,CAACjD,GAAG,CAACiC,UAAJ,CAAeqK,MAAf,CAAL,EAA6B;AAC3BmI,kBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA;AACD;;AAED6M,gBAAAA,KAAK,GAAGI,OAAO,CAACjP,GAAD,CAAf;;AAEA,oBAAI,CAACqD,IAAI,CAAC8N,QAAV,EAAoB;AAClBsD,kBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA;AACD;;AAEDyS,gBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA,uBAAOqO,YAAY,CAACxB,KAAK,CAAC5L,KAAP,CAAnB;;AAEF,mBAAK,EAAL;AACE2Q,gBAAAA,QAAQ,GAAGa,UAAU,CAACtS,IAAtB;AACAkS,gBAAAA,WAAW,CAACT,QAAQ,CAAC5T,GAAV,CAAX,GAA4BP,aAAa,CAAC,EAAD,EAAKoP,KAAL,EAAY;AACnD5L,kBAAAA,KAAK,EAAE2Q,QAAQ,CAAC3Q;AADmC,iBAAZ,CAAzC;AAGAwR,gBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA;;AAEF,mBAAK,EAAL;AACEyS,gBAAAA,UAAU,CAACzS,IAAX,GAAkB,EAAlB;AACA,uBAAOqO,YAAY,CAACxB,KAAD,CAAnB;;AAEF,mBAAK,EAAL;AACEyF,gBAAAA,SAAS,GAAGG,UAAU,CAACtS,IAAvB;AACAkS,gBAAAA,WAAW,CAACC,SAAS,CAACtU,GAAX,CAAX,GAA6BsU,SAAS,CAACrR,KAAvC;;AAEF,mBAAK,EAAL;AACEwR,gBAAAA,UAAU,CAACzS,IAAX,GAAkB,CAAlB;AACA;;AAEF,mBAAK,EAAL;AACE,uBAAOyS,UAAU,CAACjS,MAAX,CAAkB,QAAlB,EAA4B6R,WAA5B,CAAP;;AAEF,mBAAK,EAAL;AACA,mBAAK,KAAL;AACE,uBAAOI,UAAU,CAAC/R,IAAX,EAAP;AA3DJ;AA6DD;AACF,SAhEM,EAgEJ0R,SAhEI,CAAP;AAiED,OA3ED,CAFY,CAAZ;;AA+EA,eAASzI,GAAT,GAAe;AACb,eAAOwI,KAAK,CAAC3U,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAP;AACD;;AAED,aAAO+L,GAAP;AACD,KArFI;AAxTA,GAAP;AA+YD,CA1eD","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar KeyValueStore = require('./keyValueStore');\n\nvar Thread = require('./thread');\n\nvar GhostThread = require('./ghost');\n\nvar API = require('./api');\n\nvar _require = require('./utils'),\n    throwIfUndefined = _require.throwIfUndefined,\n    throwIfNotEqualLenArrays = _require.throwIfNotEqualLenArrays;\n\nvar OrbitDBAddress = require('orbit-db/src/orbit-db-address');\n\nvar resolveDID = require('did-resolver')[\"default\"];\n\nvar nameToSpaceName = function nameToSpaceName(name) {\n  return \"3box.space.\".concat(name, \".keyvalue\");\n};\n\nvar namesTothreadName = function namesTothreadName(spaceName, threadName) {\n  return \"3box.thread.\".concat(spaceName, \".\").concat(threadName);\n};\n\nvar namesToChatName = function namesToChatName(spaceName, chatName) {\n  return \"3box.ghost.\".concat(spaceName, \".\").concat(chatName);\n};\n\nvar findSpacePubKey =\n/*#__PURE__*/\nfunction () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])(\n  /*#__PURE__*/\n  _regenerator[\"default\"].mark(function _callee(did, spaceName) {\n    var doc, pubkey;\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!did.startsWith('0x')) {\n              _context.next = 4;\n              break;\n            }\n\n            _context.next = 3;\n            return API.getSpaceDID(did, spaceName);\n\n          case 3:\n            did = _context.sent;\n\n          case 4:\n            _context.next = 6;\n            return resolveDID(did);\n\n          case 6:\n            doc = _context.sent;\n            pubkey = doc.publicKey.find(function (key) {\n              return key.id.includes('#subEncryptionKey');\n            });\n\n            if (pubkey) {\n              _context.next = 16;\n              break;\n            }\n\n            _context.next = 11;\n            return API.getSpaceDID(did, spaceName);\n\n          case 11:\n            did = _context.sent;\n            _context.next = 14;\n            return resolveDID(did);\n\n          case 14:\n            doc = _context.sent;\n            pubkey = doc.publicKey.find(function (key) {\n              return key.id.includes('#subEncryptionKey');\n            });\n\n          case 16:\n            return _context.abrupt(\"return\", pubkey.publicKeyBase64);\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function findSpacePubKey(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n/** Class representing a user. */\n\n\nvar User =\n/*#__PURE__*/\nfunction () {\n  function User(spaceName, threeId) {\n    (0, _classCallCheck2[\"default\"])(this, User);\n    this._name = spaceName;\n    this._3id = threeId;\n  }\n  /**\n   * @property {String} DID            the DID of the user\n   */\n\n\n  (0, _createClass2[\"default\"])(User, [{\n    key: \"signClaim\",\n\n    /**\n     * Sign a JWT claim\n     *\n     * @param     {Object}    payload                 The payload to sign\n     * @param     {Object}    opts                    Optional parameters\n     *\n     * @return    {String}                            The signed JWT\n     */\n    value: function () {\n      var _signClaim = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee2(payload) {\n        var opts,\n            _args2 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                opts = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : {};\n                return _context2.abrupt(\"return\", this._3id.signJWT(payload, Object.assign(opts, {\n                  space: this._name\n                })));\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signClaim(_x3) {\n        return _signClaim.apply(this, arguments);\n      }\n\n      return signClaim;\n    }()\n    /**\n     * Encrypt a message. By default encrypts messages symmetrically\n     * with the users private key. If the `to` parameter is used,\n     * the message will be asymmetrically encrypted to the recipient.\n     *\n     * @param     {String}    message                 The message to encrypt\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {String}    to                      The receiver of the message, a DID or an ethereum address\n     *\n     * @return    {Object}                            An object containing the encrypted payload\n     */\n\n  }, {\n    key: \"encrypt\",\n    value: function () {\n      var _encrypt = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee3(message) {\n        var _ref2,\n            to,\n            toPubkey,\n            _args3 = arguments;\n\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref2 = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {}, to = _ref2.to;\n\n                if (!to) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 4;\n                return findSpacePubKey(to, this._name);\n\n              case 4:\n                toPubkey = _context3.sent;\n\n              case 5:\n                return _context3.abrupt(\"return\", this._3id.encrypt(message, this._name, toPubkey));\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function encrypt(_x4) {\n        return _encrypt.apply(this, arguments);\n      }\n\n      return encrypt;\n    }()\n    /**\n     * Decrypts a message if the user owns the correct key to decrypt it.\n     *\n     * @param     {Object}    encryptedObject         The encrypted message to decrypt (as encoded by the `encrypt` method\n     *\n     * @return    {String}                            The clear text message\n     */\n\n  }, {\n    key: \"decrypt\",\n    value: function () {\n      var _decrypt = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee4(encryptedObject, toBuffer) {\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this._3id.decrypt(encryptedObject, this._name, toBuffer));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function decrypt(_x5, _x6) {\n        return _decrypt.apply(this, arguments);\n      }\n\n      return decrypt;\n    }()\n  }, {\n    key: \"DID\",\n    get: function get() {\n      return this._3id.getSubDID(this._name);\n    }\n  }]);\n  return User;\n}();\n\nvar Space =\n/*#__PURE__*/\nfunction () {\n  /**\n   * Please use **box.openSpace** to get the instance of this class\n   */\n  function Space(name, replicator) {\n    (0, _classCallCheck2[\"default\"])(this, Space);\n    this._name = name;\n    this._replicator = replicator;\n    this._store = new KeyValueStore(nameToSpaceName(this._name), this._replicator);\n    this._activeThreads = {};\n    /**\n     * @property {KeyValueStore} public         access the profile store of the space\n     */\n\n    this[\"public\"] = null;\n    /**\n     * @property {KeyValueStore} private        access the private store of the space\n     */\n\n    this[\"private\"] = null;\n    /**\n     * @property {Promise}       syncDone       A promise that is resolved when the space data is synced\n     */\n\n    this.syncDone = null;\n  }\n\n  (0, _createClass2[\"default\"])(Space, [{\n    key: \"open\",\n    value: function () {\n      var _open = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee6(threeId) {\n        var _this = this;\n\n        var opts,\n            authenticated,\n            syncSpace,\n            _args6 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                opts = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : {};\n\n                if (this.isOpen) {\n                  _context6.next = 18;\n                  break;\n                }\n\n                // store is not loaded opened yet\n                this._3id = threeId;\n                _context6.next = 5;\n                return this._3id.isAuthenticated([this._name]);\n\n              case 5:\n                authenticated = _context6.sent;\n\n                if (authenticated) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                _context6.next = 9;\n                return this._3id.authenticate([this._name]);\n\n              case 9:\n                if (opts.consentCallback) opts.consentCallback(!authenticated, this._name);\n                _context6.next = 12;\n                return this._store._load(this._3id);\n\n              case 12:\n                syncSpace =\n                /*#__PURE__*/\n                function () {\n                  var _ref3 = (0, _asyncToGenerator2[\"default\"])(\n                  /*#__PURE__*/\n                  _regenerator[\"default\"].mark(function _callee5() {\n                    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            _context5.next = 2;\n                            return _this._store._sync();\n\n                          case 2:\n                            if (opts.onSyncDone) opts.onSyncDone();\n\n                          case 3:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n\n                  return function syncSpace() {\n                    return _ref3.apply(this, arguments);\n                  };\n                }();\n\n                this.syncDone = syncSpace();\n                this[\"public\"] = publicStoreReducer(this._store);\n                this[\"private\"] = privateStoreReducer(this._store, this._3id, this._name); // make sure we're authenticated to all threads\n\n                _context6.next = 18;\n                return this._authThreads(this._3id);\n\n              case 18:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function open(_x7) {\n        return _open.apply(this, arguments);\n      }\n\n      return open;\n    }()\n  }, {\n    key: \"_authThreads\",\n    value: function () {\n      var _authThreads2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee7(threeId) {\n        var odbIdentity;\n        return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return threeId.getOdbId(this._name);\n\n              case 2:\n                odbIdentity = _context7.sent;\n                Object.values(this._activeThreads).forEach(function (thread) {\n                  if (thread.isGhost) {\n                    thread._set3id(threeId);\n                  } else {\n                    thread._setIdentity(odbIdentity);\n                  }\n                });\n\n              case 4:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _authThreads(_x8) {\n        return _authThreads2.apply(this, arguments);\n      }\n\n      return _authThreads;\n    }()\n    /**\n     * Join a thread. Use this to start receiving updates from, and to post in threads\n     *\n     * @param     {String}    name                    The name of the thread\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {String}    opts.firstModerator     DID of first moderator of a thread, by default, user is first moderator\n     * @param     {Boolean}   opts.members            join a members only thread, which only members can post in, defaults to open thread\n     * @param     {Boolean}   opts.confidential       create a confidential thread with true or join existing confidential thread with an encKeyId string\n     * @param     {Boolean}   opts.noAutoSub          Disable auto subscription to the thread when posting to it (default false)\n     * @param     {Boolean}   opts.ghost              Enable ephemeral messaging via Ghost Thread\n     * @param     {Number}    opts.ghostBacklogLimit  The number of posts to maintain in the ghost backlog\n     * @param     {Array<Function>} opts.ghostFilters Array of functions for filtering messages\n     *\n     * @return    {Thread}                  An instance of the thread class for the joined thread\n     */\n\n  }, {\n    key: \"joinThread\",\n    value: function () {\n      var _joinThread = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee8(name) {\n        var opts,\n            ghostAddress,\n            subscribeFn,\n            user,\n            thread,\n            address,\n            _args8 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                opts = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {};\n\n                if (!opts.ghost) {\n                  _context8.next = 8;\n                  break;\n                }\n\n                ghostAddress = namesToChatName(this._name, name);\n\n                if (!this._activeThreads[ghostAddress]) {\n                  this._activeThreads[ghostAddress] = new GhostThread(ghostAddress, this._replicator, this._3id, opts);\n                }\n\n                if (this._3id) {\n                  this._activeThreads[ghostAddress]._set3id(this._3id);\n                }\n\n                return _context8.abrupt(\"return\", this._activeThreads[ghostAddress]);\n\n              case 8:\n                subscribeFn = opts.noAutoSub ? function () {} : this.subscribeThread.bind(this);\n\n                if (!opts.confidential) {\n                  _context8.next = 12;\n                  break;\n                }\n\n                if (this._3id) {\n                  _context8.next = 12;\n                  break;\n                }\n\n                throw new Error('confidential threads require user to be authenticated');\n\n              case 12:\n                if (opts.firstModerator) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                if (this._3id) {\n                  _context8.next = 15;\n                  break;\n                }\n\n                throw new Error('firstModerator required if not authenticated');\n\n              case 15:\n                opts.firstModerator = this._3id.getSubDID(this._name);\n\n              case 16:\n                user = this._3id ? this.user : {};\n                thread = new Thread(namesTothreadName(this._name, name), this._replicator, opts.members, opts.firstModerator, opts.confidential, user, subscribeFn);\n                _context8.next = 20;\n                return thread._getThreadAddress();\n\n              case 20:\n                address = _context8.sent;\n\n                if (!this._activeThreads[address]) {\n                  _context8.next = 23;\n                  break;\n                }\n\n                return _context8.abrupt(\"return\", this._activeThreads[address]);\n\n              case 23:\n                _context8.next = 25;\n                return thread._load();\n\n              case 25:\n                if (!this._3id) {\n                  _context8.next = 32;\n                  break;\n                }\n\n                _context8.t0 = thread;\n                _context8.next = 29;\n                return this._3id.getOdbId(this._name);\n\n              case 29:\n                _context8.t1 = _context8.sent;\n                _context8.next = 32;\n                return _context8.t0._setIdentity.call(_context8.t0, _context8.t1);\n\n              case 32:\n                this._activeThreads[address] = thread;\n                return _context8.abrupt(\"return\", thread);\n\n              case 34:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function joinThread(_x9) {\n        return _joinThread.apply(this, arguments);\n      }\n\n      return joinThread;\n    }()\n    /**\n     * Create a confidential thread\n     *\n     * @param     {String}    name          The name of the thread\n     *\n     * @return    {Thread}                  An instance of the thread class for the created thread\n     */\n\n  }, {\n    key: \"createConfidentialThread\",\n    value: function () {\n      var _createConfidentialThread = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee9(name) {\n        return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                return _context9.abrupt(\"return\", this.joinThread(name, {\n                  confidential: true\n                }));\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function createConfidentialThread(_x10) {\n        return _createConfidentialThread.apply(this, arguments);\n      }\n\n      return createConfidentialThread;\n    }()\n    /**\n     * Join a thread by full thread address. Use this to start receiving updates from, and to post in threads\n     *\n     * @param     {String}    address                 The full address of the thread\n     * @param     {Object}    opts                    Optional parameters\n     * @param     {Boolean}   opts.noAutoSub          Disable auto subscription to the thread when posting to it (default false)\n     *\n     * @return    {Thread}                            An instance of the thread class for the joined thread\n     */\n\n  }, {\n    key: \"joinThreadByAddress\",\n    value: function () {\n      var _joinThreadByAddress = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee10(address) {\n        var opts,\n            threadSpace,\n            threadName,\n            subscribeFn,\n            user,\n            thread,\n            _args10 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                opts = _args10.length > 1 && _args10[1] !== undefined ? _args10[1] : {};\n\n                if (OrbitDBAddress.isValid(address)) {\n                  _context10.next = 3;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress: valid orbitdb address required');\n\n              case 3:\n                if (this.isOpen) {\n                  _context10.next = 5;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress requires space to be open');\n\n              case 5:\n                threadSpace = address.split('.')[2];\n                threadName = address.split('.')[3];\n\n                if (!(threadSpace !== this._name)) {\n                  _context10.next = 9;\n                  break;\n                }\n\n                throw new Error('joinThreadByAddress: attempting to open thread from different space, must open within same space');\n\n              case 9:\n                if (!this._activeThreads[address]) {\n                  _context10.next = 11;\n                  break;\n                }\n\n                return _context10.abrupt(\"return\", this._activeThreads[address]);\n\n              case 11:\n                subscribeFn = opts.noAutoSub ? function () {} : this.subscribeThread.bind(this);\n                user = this._3id ? this.user : {};\n                thread = new Thread(namesTothreadName(this._name, threadName), this._replicator, undefined, undefined, undefined, user, subscribeFn);\n                _context10.next = 16;\n                return thread._load(address);\n\n              case 16:\n                if (!this._3id) {\n                  _context10.next = 23;\n                  break;\n                }\n\n                _context10.t0 = thread;\n                _context10.next = 20;\n                return this._3id.getOdbId(this._name);\n\n              case 20:\n                _context10.t1 = _context10.sent;\n                _context10.next = 23;\n                return _context10.t0._setIdentity.call(_context10.t0, _context10.t1);\n\n              case 23:\n                this._activeThreads[address] = thread;\n                return _context10.abrupt(\"return\", thread);\n\n              case 25:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function joinThreadByAddress(_x11) {\n        return _joinThreadByAddress.apply(this, arguments);\n      }\n\n      return joinThreadByAddress;\n    }()\n    /**\n     * Subscribe to the given thread, if not already subscribed\n     *\n     * @param     {String}    address                The address of the thread\n     * @param     {Object}    config                configuration and thread meta data\n     * @param     {String}    opts.name             Name of thread\n     * @param     {String}    opts.firstModerator   DID of the first moderator\n     * @param     {String}    opts.members          Boolean string, true if a members only thread\n     */\n\n  }, {\n    key: \"subscribeThread\",\n    value: function () {\n      var _subscribeThread = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee11(address) {\n        var config,\n            threadKey,\n            _args11 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                config = _args11.length > 1 && _args11[1] !== undefined ? _args11[1] : {};\n\n                if (OrbitDBAddress.isValid(address)) {\n                  _context11.next = 3;\n                  break;\n                }\n\n                throw new Error('subscribeThread: must subscribe to valid thread/orbitdb address');\n\n              case 3:\n                if (this.isOpen) {\n                  _context11.next = 5;\n                  break;\n                }\n\n                return _context11.abrupt(\"return\");\n\n              case 5:\n                // we can't subscribe if space isn't open\n                threadKey = \"thread-\".concat(address);\n                _context11.next = 8;\n                return this.syncDone;\n\n              case 8:\n                _context11.next = 10;\n                return this[\"public\"].get(threadKey);\n\n              case 10:\n                if (_context11.sent) {\n                  _context11.next = 13;\n                  break;\n                }\n\n                _context11.next = 13;\n                return this[\"public\"].set(threadKey, Object.assign({}, config, {\n                  address: address\n                }));\n\n              case 13:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function subscribeThread(_x12) {\n        return _subscribeThread.apply(this, arguments);\n      }\n\n      return subscribeThread;\n    }()\n    /**\n     * Unsubscribe from the given thread, if subscribed\n     *\n     * @param     {String}    address     The address of the thread\n     */\n\n  }, {\n    key: \"unsubscribeThread\",\n    value: function () {\n      var _unsubscribeThread = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee12(address) {\n        var threadKey;\n        return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (this.isOpen) {\n                  _context12.next = 2;\n                  break;\n                }\n\n                throw new Error('unsubscribeThread requires space to be open');\n\n              case 2:\n                threadKey = \"thread-\".concat(address);\n                _context12.next = 5;\n                return this[\"public\"].get(threadKey);\n\n              case 5:\n                if (!_context12.sent) {\n                  _context12.next = 8;\n                  break;\n                }\n\n                _context12.next = 8;\n                return this[\"public\"].remove(threadKey);\n\n              case 8:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function unsubscribeThread(_x13) {\n        return _unsubscribeThread.apply(this, arguments);\n      }\n\n      return unsubscribeThread;\n    }()\n    /**\n     * Get a list of all the threads subscribed to in this space\n     *\n     * @return    {Array<Objects>}    A list of thread objects as { address, firstModerator, members, name}\n     */\n\n  }, {\n    key: \"subscribedThreads\",\n    value: function () {\n      var _subscribedThreads = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee13() {\n        var allEntries;\n        return _regenerator[\"default\"].wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                if (this.isOpen) {\n                  _context13.next = 2;\n                  break;\n                }\n\n                throw new Error('subscribedThreads requires space to be open');\n\n              case 2:\n                _context13.next = 4;\n                return this[\"public\"].all();\n\n              case 4:\n                allEntries = _context13.sent;\n                return _context13.abrupt(\"return\", Object.keys(allEntries).reduce(function (threads, key) {\n                  if (key.startsWith('thread')) {\n                    // ignores experimental threads (v1)\n                    var address = key.split('thread-')[1];\n\n                    if (OrbitDBAddress.isValid(address)) {\n                      threads.push(allEntries[key]);\n                    }\n                  }\n\n                  return threads;\n                }, []));\n\n              case 6:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function subscribedThreads() {\n        return _subscribedThreads.apply(this, arguments);\n      }\n\n      return subscribedThreads;\n    }()\n  }, {\n    key: \"DID\",\n    get: function get() {\n      return this.user.DID;\n    }\n    /**\n     * @property {User} user            access the user object to encrypt data and sign claims\n     */\n\n  }, {\n    key: \"user\",\n    get: function get() {\n      if (!this._3id) throw new Error('user is not authenticated');\n      this._user = this._user || new User(this._name, this._3id);\n      return this._user;\n    }\n  }, {\n    key: \"isOpen\",\n    get: function get() {\n      return Boolean(this._store._db);\n    }\n  }]);\n  return Space;\n}();\n\nmodule.exports = Space;\n\nvar publicStoreReducer = function publicStoreReducer(store) {\n  var PREFIX = 'pub_';\n  return {\n    get: function () {\n      var _get = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee14(key) {\n        var opts,\n            _args14 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                opts = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : {};\n                return _context14.abrupt(\"return\", store.get(PREFIX + key, opts));\n\n              case 2:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n\n      function get(_x14) {\n        return _get.apply(this, arguments);\n      }\n\n      return get;\n    }(),\n    getMetadata: function () {\n      var _getMetadata = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee15(key) {\n        return _regenerator[\"default\"].wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                return _context15.abrupt(\"return\", store.getMetadata(PREFIX + key));\n\n              case 1:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n\n      function getMetadata(_x15) {\n        return _getMetadata.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }(),\n    set: function () {\n      var _set = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee16(key, value) {\n        return _regenerator[\"default\"].wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n                return _context16.abrupt(\"return\", store.set(PREFIX + key, value));\n\n              case 2:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16);\n      }));\n\n      function set(_x16, _x17) {\n        return _set.apply(this, arguments);\n      }\n\n      return set;\n    }(),\n    setMultiple: function () {\n      var _setMultiple = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee17(keys, values) {\n        var prefixedKeys;\n        return _regenerator[\"default\"].wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n                prefixedKeys = keys.map(function (key) {\n                  return PREFIX + key;\n                });\n                return _context17.abrupt(\"return\", store.setMultiple(prefixedKeys, values));\n\n              case 3:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17);\n      }));\n\n      function setMultiple(_x18, _x19) {\n        return _setMultiple.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }(),\n    remove: function () {\n      var _remove = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee18(key) {\n        return _regenerator[\"default\"].wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                throwIfUndefined(key, 'key');\n                return _context18.abrupt(\"return\", store.remove(PREFIX + key));\n\n              case 2:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18);\n      }));\n\n      function remove(_x20) {\n        return _remove.apply(this, arguments);\n      }\n\n      return remove;\n    }(),\n    log: function () {\n      var _log = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee19() {\n        return _regenerator[\"default\"].wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return store.log();\n\n              case 2:\n                _context19.t0 = function (newLog, entry) {\n                  if (entry.key.startsWith(PREFIX)) {\n                    entry.key = entry.key.slice(4);\n                    newLog.push(entry);\n                  }\n\n                  return newLog;\n                };\n\n                _context19.t1 = [];\n                return _context19.abrupt(\"return\", _context19.sent.reduce(_context19.t0, _context19.t1));\n\n              case 5:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n\n      function log() {\n        return _log.apply(this, arguments);\n      }\n\n      return log;\n    }(),\n    all: function () {\n      var _all = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee20(opts) {\n        var entries;\n        return _regenerator[\"default\"].wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return store.all(opts);\n\n              case 2:\n                entries = _context20.sent;\n                return _context20.abrupt(\"return\", Object.keys(entries).reduce(function (newAll, key) {\n                  if (key.startsWith(PREFIX)) {\n                    newAll[key.slice(4)] = entries[key];\n                  }\n\n                  return newAll;\n                }, {}));\n\n              case 4:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n\n      function all(_x21) {\n        return _all.apply(this, arguments);\n      }\n\n      return all;\n    }()\n  };\n};\n\nvar privateStoreReducer = function privateStoreReducer(store, threeId, spaceName) {\n  var PREFIX = 'priv_';\n\n  var dbKey =\n  /*#__PURE__*/\n  function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])(\n    /*#__PURE__*/\n    _regenerator[\"default\"].mark(function _callee21(key) {\n      return _regenerator[\"default\"].wrap(function _callee21$(_context21) {\n        while (1) {\n          switch (_context21.prev = _context21.next) {\n            case 0:\n              throwIfUndefined(key, 'key');\n              _context21.t0 = PREFIX;\n              _context21.next = 4;\n              return threeId.hashDBKey(key, spaceName);\n\n            case 4:\n              _context21.t1 = _context21.sent;\n              return _context21.abrupt(\"return\", _context21.t0 + _context21.t1);\n\n            case 6:\n            case \"end\":\n              return _context21.stop();\n          }\n        }\n      }, _callee21);\n    }));\n\n    return function dbKey(_x22) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var encryptEntry =\n  /*#__PURE__*/\n  function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])(\n    /*#__PURE__*/\n    _regenerator[\"default\"].mark(function _callee22(entry) {\n      return _regenerator[\"default\"].wrap(function _callee22$(_context22) {\n        while (1) {\n          switch (_context22.prev = _context22.next) {\n            case 0:\n              return _context22.abrupt(\"return\", threeId.encrypt(JSON.stringify(entry), spaceName));\n\n            case 1:\n            case \"end\":\n              return _context22.stop();\n          }\n        }\n      }, _callee22);\n    }));\n\n    return function encryptEntry(_x23) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var decryptEntry =\n  /*#__PURE__*/\n  function () {\n    var _ref6 = (0, _asyncToGenerator2[\"default\"])(\n    /*#__PURE__*/\n    _regenerator[\"default\"].mark(function _callee23(encObj) {\n      return _regenerator[\"default\"].wrap(function _callee23$(_context23) {\n        while (1) {\n          switch (_context23.prev = _context23.next) {\n            case 0:\n              _context23.t0 = JSON;\n              _context23.next = 3;\n              return threeId.decrypt(encObj, spaceName);\n\n            case 3:\n              _context23.t1 = _context23.sent;\n              return _context23.abrupt(\"return\", _context23.t0.parse.call(_context23.t0, _context23.t1));\n\n            case 5:\n            case \"end\":\n              return _context23.stop();\n          }\n        }\n      }, _callee23);\n    }));\n\n    return function decryptEntry(_x24) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  return {\n    get: function () {\n      var _get2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee24(key) {\n        var opts,\n            entry,\n            _args24 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                opts = _args24.length > 1 && _args24[1] !== undefined ? _args24[1] : {};\n                _context24.t0 = store;\n                _context24.next = 4;\n                return dbKey(key);\n\n              case 4:\n                _context24.t1 = _context24.sent;\n                _context24.t2 = opts;\n                _context24.next = 8;\n                return _context24.t0.get.call(_context24.t0, _context24.t1, _context24.t2);\n\n              case 8:\n                entry = _context24.sent;\n\n                if (entry) {\n                  _context24.next = 11;\n                  break;\n                }\n\n                return _context24.abrupt(\"return\", null);\n\n              case 11:\n                if (!opts.metadata) {\n                  _context24.next = 20;\n                  break;\n                }\n\n                _context24.t3 = _objectSpread;\n                _context24.t4 = {};\n                _context24.t5 = entry;\n                _context24.next = 17;\n                return decryptEntry(entry.value);\n\n              case 17:\n                _context24.t6 = _context24.sent.value;\n                _context24.t7 = {\n                  value: _context24.t6\n                };\n                return _context24.abrupt(\"return\", (0, _context24.t3)(_context24.t4, _context24.t5, _context24.t7));\n\n              case 20:\n                _context24.next = 22;\n                return decryptEntry(entry);\n\n              case 22:\n                return _context24.abrupt(\"return\", _context24.sent.value);\n\n              case 23:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24);\n      }));\n\n      function get(_x25) {\n        return _get2.apply(this, arguments);\n      }\n\n      return get;\n    }(),\n    getMetadata: function () {\n      var _getMetadata2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee25(key) {\n        return _regenerator[\"default\"].wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                _context25.t0 = store;\n                _context25.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context25.t1 = _context25.sent;\n                return _context25.abrupt(\"return\", _context25.t0.getMetadata.call(_context25.t0, _context25.t1));\n\n              case 5:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25);\n      }));\n\n      function getMetadata(_x26) {\n        return _getMetadata2.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }(),\n    set: function () {\n      var _set2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee26(key, value) {\n        return _regenerator[\"default\"].wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.t0 = store;\n                _context26.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context26.t1 = _context26.sent;\n                _context26.next = 6;\n                return encryptEntry({\n                  key: key,\n                  value: value\n                });\n\n              case 6:\n                _context26.t2 = _context26.sent;\n                return _context26.abrupt(\"return\", _context26.t0.set.call(_context26.t0, _context26.t1, _context26.t2));\n\n              case 8:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26);\n      }));\n\n      function set(_x27, _x28) {\n        return _set2.apply(this, arguments);\n      }\n\n      return set;\n    }(),\n    setMultiple: function () {\n      var _setMultiple2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee27(keys, values) {\n        var dbKeys, encryptedEntries;\n        return _regenerator[\"default\"].wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                throwIfNotEqualLenArrays(keys, values);\n                _context27.next = 3;\n                return Promise.all(keys.map(dbKey));\n\n              case 3:\n                dbKeys = _context27.sent;\n                _context27.next = 6;\n                return Promise.all(values.map(function (value, index) {\n                  return encryptEntry({\n                    key: keys[index],\n                    value: value\n                  });\n                }));\n\n              case 6:\n                encryptedEntries = _context27.sent;\n                return _context27.abrupt(\"return\", store.setMultiple(dbKeys, encryptedEntries));\n\n              case 8:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27);\n      }));\n\n      function setMultiple(_x29, _x30) {\n        return _setMultiple2.apply(this, arguments);\n      }\n\n      return setMultiple;\n    }(),\n    remove: function () {\n      var _remove2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee28(key) {\n        return _regenerator[\"default\"].wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _context28.t0 = store;\n                _context28.next = 3;\n                return dbKey(key);\n\n              case 3:\n                _context28.t1 = _context28.sent;\n                return _context28.abrupt(\"return\", _context28.t0.remove.call(_context28.t0, _context28.t1));\n\n              case 5:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28);\n      }));\n\n      function remove(_x31) {\n        return _remove2.apply(this, arguments);\n      }\n\n      return remove;\n    }(),\n    log: function () {\n      var _log2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee29() {\n        var log, privLog, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, entry, decEntry;\n\n        return _regenerator[\"default\"].wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                _context29.next = 2;\n                return store.log();\n\n              case 2:\n                log = _context29.sent;\n                privLog = [];\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context29.prev = 7;\n                _iterator = log[Symbol.iterator]();\n\n              case 9:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context29.next = 21;\n                  break;\n                }\n\n                entry = _step.value;\n\n                if (!entry.key.startsWith(PREFIX)) {\n                  _context29.next = 18;\n                  break;\n                }\n\n                _context29.next = 14;\n                return decryptEntry(entry.value);\n\n              case 14:\n                decEntry = _context29.sent;\n                entry.key = decEntry.key;\n                entry.value = decEntry.value;\n                privLog.push(entry);\n\n              case 18:\n                _iteratorNormalCompletion = true;\n                _context29.next = 9;\n                break;\n\n              case 21:\n                _context29.next = 27;\n                break;\n\n              case 23:\n                _context29.prev = 23;\n                _context29.t0 = _context29[\"catch\"](7);\n                _didIteratorError = true;\n                _iteratorError = _context29.t0;\n\n              case 27:\n                _context29.prev = 27;\n                _context29.prev = 28;\n\n                if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n                  _iterator[\"return\"]();\n                }\n\n              case 30:\n                _context29.prev = 30;\n\n                if (!_didIteratorError) {\n                  _context29.next = 33;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 33:\n                return _context29.finish(30);\n\n              case 34:\n                return _context29.finish(27);\n\n              case 35:\n                return _context29.abrupt(\"return\", privLog);\n\n              case 36:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, null, [[7, 23, 27, 35], [28,, 30, 34]]);\n      }));\n\n      function log() {\n        return _log2.apply(this, arguments);\n      }\n\n      return log;\n    }(),\n    all: function () {\n      var _all2 = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee30() {\n        var opts,\n            entries,\n            privEntries,\n            key,\n            entry,\n            decEntry,\n            _decEntry,\n            _args30 = arguments;\n\n        return _regenerator[\"default\"].wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                opts = _args30.length > 0 && _args30[0] !== undefined ? _args30[0] : {};\n                _context30.next = 3;\n                return store.all(opts);\n\n              case 3:\n                entries = _context30.sent;\n                privEntries = {};\n                _context30.t0 = _regenerator[\"default\"].keys(entries);\n\n              case 6:\n                if ((_context30.t1 = _context30.t0()).done) {\n                  _context30.next = 23;\n                  break;\n                }\n\n                key = _context30.t1.value;\n\n                if (!key.startsWith(PREFIX)) {\n                  _context30.next = 21;\n                  break;\n                }\n\n                entry = entries[key];\n\n                if (!opts.metadata) {\n                  _context30.next = 17;\n                  break;\n                }\n\n                _context30.next = 13;\n                return decryptEntry(entry.value);\n\n              case 13:\n                decEntry = _context30.sent;\n                privEntries[decEntry.key] = _objectSpread({}, entry, {\n                  value: decEntry.value\n                });\n                _context30.next = 21;\n                break;\n\n              case 17:\n                _context30.next = 19;\n                return decryptEntry(entry);\n\n              case 19:\n                _decEntry = _context30.sent;\n                privEntries[_decEntry.key] = _decEntry.value;\n\n              case 21:\n                _context30.next = 6;\n                break;\n\n              case 23:\n                return _context30.abrupt(\"return\", privEntries);\n\n              case 24:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30);\n      }));\n\n      function all() {\n        return _all2.apply(this, arguments);\n      }\n\n      return all;\n    }()\n  };\n};"]},"metadata":{},"sourceType":"script"}