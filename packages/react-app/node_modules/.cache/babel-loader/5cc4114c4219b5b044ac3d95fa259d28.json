{"ast":null,"code":"'use strict';\n\nconst {\n  sortBy\n} = require('../../utils');\n\nconst Entry = require('./entry');\n\nclass Wantlist {\n  constructor(stats) {\n    this.set = new Map();\n    this._stats = stats;\n  }\n\n  get length() {\n    return this.set.size;\n  }\n\n  add(cid, priority) {\n    const cidStr = cid.toString('base58btc');\n    const entry = this.set.get(cidStr);\n\n    if (entry) {\n      entry.inc();\n      entry.priority = priority;\n    } else {\n      this.set.set(cidStr, new Entry(cid, priority));\n\n      if (this._stats) {\n        this._stats.push(null, 'wantListSize', 1);\n      }\n    }\n  }\n\n  remove(cid) {\n    const cidStr = cid.toString('base58btc');\n    const entry = this.set.get(cidStr);\n\n    if (!entry) {\n      return;\n    }\n\n    entry.dec(); // only delete when no refs are held\n\n    if (entry.hasRefs()) {\n      return;\n    }\n\n    this.set.delete(cidStr);\n\n    if (this._stats) {\n      this._stats.push(null, 'wantListSize', -1);\n    }\n  }\n\n  removeForce(cidStr) {\n    if (this.set.has(cidStr)) {\n      this.set.delete(cidStr);\n    }\n  }\n\n  forEach(fn) {\n    return this.set.forEach(fn);\n  }\n\n  entries() {\n    return this.set.entries();\n  }\n\n  sortedEntries() {\n    return new Map(sortBy(o => o[1].key, Array.from(this.set.entries())));\n  }\n\n  contains(cid) {\n    const cidStr = cid.toString('base58btc');\n    return this.set.get(cidStr);\n  }\n\n}\n\nWantlist.Entry = Entry;\nmodule.exports = Wantlist;","map":{"version":3,"sources":["/home/samkuhlmann/Documents/ody/moloch/moloch-dao-badges/node_modules/ipfs-bitswap/src/types/wantlist/index.js"],"names":["sortBy","require","Entry","Wantlist","constructor","stats","set","Map","_stats","length","size","add","cid","priority","cidStr","toString","entry","get","inc","push","remove","dec","hasRefs","delete","removeForce","has","forEach","fn","entries","sortedEntries","o","key","Array","from","contains","module","exports"],"mappings":"AAAA;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAaC,OAAO,CAAC,aAAD,CAA1B;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAC,SAAD,CAArB;;AAEA,MAAME,QAAN,CAAe;AACbC,EAAAA,WAAW,CAAEC,KAAF,EAAS;AAClB,SAAKC,GAAL,GAAW,IAAIC,GAAJ,EAAX;AACA,SAAKC,MAAL,GAAcH,KAAd;AACD;;AAED,MAAII,MAAJ,GAAc;AACZ,WAAO,KAAKH,GAAL,CAASI,IAAhB;AACD;;AAEDC,EAAAA,GAAG,CAAEC,GAAF,EAAOC,QAAP,EAAiB;AAClB,UAAMC,MAAM,GAAGF,GAAG,CAACG,QAAJ,CAAa,WAAb,CAAf;AACA,UAAMC,KAAK,GAAG,KAAKV,GAAL,CAASW,GAAT,CAAaH,MAAb,CAAd;;AAEA,QAAIE,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAACE,GAAN;AACAF,MAAAA,KAAK,CAACH,QAAN,GAAiBA,QAAjB;AACD,KAHD,MAGO;AACL,WAAKP,GAAL,CAASA,GAAT,CAAaQ,MAAb,EAAqB,IAAIZ,KAAJ,CAAUU,GAAV,EAAeC,QAAf,CAArB;;AACA,UAAI,KAAKL,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYW,IAAZ,CAAiB,IAAjB,EAAuB,cAAvB,EAAuC,CAAvC;AACD;AACF;AACF;;AAEDC,EAAAA,MAAM,CAAER,GAAF,EAAO;AACX,UAAME,MAAM,GAAGF,GAAG,CAACG,QAAJ,CAAa,WAAb,CAAf;AACA,UAAMC,KAAK,GAAG,KAAKV,GAAL,CAASW,GAAT,CAAaH,MAAb,CAAd;;AAEA,QAAI,CAACE,KAAL,EAAY;AACV;AACD;;AAEDA,IAAAA,KAAK,CAACK,GAAN,GARW,CAUX;;AACA,QAAIL,KAAK,CAACM,OAAN,EAAJ,EAAqB;AACnB;AACD;;AAED,SAAKhB,GAAL,CAASiB,MAAT,CAAgBT,MAAhB;;AACA,QAAI,KAAKN,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYW,IAAZ,CAAiB,IAAjB,EAAuB,cAAvB,EAAuC,CAAC,CAAxC;AACD;AACF;;AAEDK,EAAAA,WAAW,CAAEV,MAAF,EAAU;AACnB,QAAI,KAAKR,GAAL,CAASmB,GAAT,CAAaX,MAAb,CAAJ,EAA0B;AACxB,WAAKR,GAAL,CAASiB,MAAT,CAAgBT,MAAhB;AACD;AACF;;AAEDY,EAAAA,OAAO,CAAEC,EAAF,EAAM;AACX,WAAO,KAAKrB,GAAL,CAASoB,OAAT,CAAiBC,EAAjB,CAAP;AACD;;AAEDC,EAAAA,OAAO,GAAI;AACT,WAAO,KAAKtB,GAAL,CAASsB,OAAT,EAAP;AACD;;AAEDC,EAAAA,aAAa,GAAI;AACf,WAAO,IAAItB,GAAJ,CAAQP,MAAM,CAAC8B,CAAC,IAAIA,CAAC,CAAC,CAAD,CAAD,CAAKC,GAAX,EAAgBC,KAAK,CAACC,IAAN,CAAW,KAAK3B,GAAL,CAASsB,OAAT,EAAX,CAAhB,CAAd,CAAP;AACD;;AAEDM,EAAAA,QAAQ,CAAEtB,GAAF,EAAO;AACb,UAAME,MAAM,GAAGF,GAAG,CAACG,QAAJ,CAAa,WAAb,CAAf;AACA,WAAO,KAAKT,GAAL,CAASW,GAAT,CAAaH,MAAb,CAAP;AACD;;AAnEY;;AAsEfX,QAAQ,CAACD,KAAT,GAAiBA,KAAjB;AACAiC,MAAM,CAACC,OAAP,GAAiBjC,QAAjB","sourcesContent":["'use strict'\n\nconst { sortBy } = require('../../utils')\nconst Entry = require('./entry')\n\nclass Wantlist {\n  constructor (stats) {\n    this.set = new Map()\n    this._stats = stats\n  }\n\n  get length () {\n    return this.set.size\n  }\n\n  add (cid, priority) {\n    const cidStr = cid.toString('base58btc')\n    const entry = this.set.get(cidStr)\n\n    if (entry) {\n      entry.inc()\n      entry.priority = priority\n    } else {\n      this.set.set(cidStr, new Entry(cid, priority))\n      if (this._stats) {\n        this._stats.push(null, 'wantListSize', 1)\n      }\n    }\n  }\n\n  remove (cid) {\n    const cidStr = cid.toString('base58btc')\n    const entry = this.set.get(cidStr)\n\n    if (!entry) {\n      return\n    }\n\n    entry.dec()\n\n    // only delete when no refs are held\n    if (entry.hasRefs()) {\n      return\n    }\n\n    this.set.delete(cidStr)\n    if (this._stats) {\n      this._stats.push(null, 'wantListSize', -1)\n    }\n  }\n\n  removeForce (cidStr) {\n    if (this.set.has(cidStr)) {\n      this.set.delete(cidStr)\n    }\n  }\n\n  forEach (fn) {\n    return this.set.forEach(fn)\n  }\n\n  entries () {\n    return this.set.entries()\n  }\n\n  sortedEntries () {\n    return new Map(sortBy(o => o[1].key, Array.from(this.set.entries())))\n  }\n\n  contains (cid) {\n    const cidStr = cid.toString('base58btc')\n    return this.set.get(cidStr)\n  }\n}\n\nWantlist.Entry = Entry\nmodule.exports = Wantlist\n"]},"metadata":{},"sourceType":"script"}