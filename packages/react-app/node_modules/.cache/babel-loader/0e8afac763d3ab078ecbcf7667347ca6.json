{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar fetch = typeof window !== 'undefined' ? window.fetch : require('node-fetch');\n\nvar Multihash = require('multihashes');\n\nvar sha256 = require('js-sha256').sha256;\n\nvar ENC_BLOCK_SIZE = 24;\nvar MAGIC_ERC1271_VALUE = '0x20c13b0b';\n\nvar pad = function pad(val) {\n  var blockSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ENC_BLOCK_SIZE;\n  var blockDiff = (blockSize - val.length % blockSize) % blockSize;\n  return \"\".concat(val).concat('\\0'.repeat(blockDiff));\n};\n\nvar unpad = function unpad(padded) {\n  return padded.replace(/\\0+$/, '');\n};\n\nvar HTTPError = function HTTPError(status, message) {\n  var e = new Error(message);\n  e.statusCode = status;\n  return e;\n};\n\nvar getMessageConsent = function getMessageConsent(did, timestamp) {\n  var msg = 'Create a new 3Box profile' + '\\n\\n' + '- \\n' + 'Your unique profile ID is ' + did;\n  if (timestamp) msg += ' \\n' + 'Timestamp: ' + timestamp;\n  return msg;\n};\n\nvar safeSend = function safeSend(provider, data) {\n  var send = (Boolean(provider.sendAsync) ? provider.sendAsync : provider.send).bind(provider);\n  return new Promise(function (resolve, reject) {\n    send(data, function (err, result) {\n      if (err) reject(err);else if (result.error) reject(result.error);else resolve(result.result);\n    });\n  });\n};\n\nvar encodeRpcCall = function encodeRpcCall(method, params, fromAddress) {\n  return {\n    jsonrpc: '2.0',\n    id: 1,\n    method: method,\n    params: params,\n    fromAddress: fromAddress\n  };\n};\n\nvar callRpc = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(provider, method, params, fromAddress) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", safeSend(provider, encodeRpcCall(method, params, fromAddress)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function callRpc(_x, _x2, _x3, _x4) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nmodule.exports = {\n  getMessageConsent: getMessageConsent,\n  callRpc: callRpc,\n  openBoxConsent: function openBoxConsent(fromAddress, ethereum) {\n    var text = 'This app wants to view and update your 3Box profile.';\n    if (ethereum.isAuthereum) return ethereum.signMessageWithSigningKey(text);\n    var msg = '0x' + Buffer.from(text, 'utf8').toString('hex');\n    var params = [msg, fromAddress];\n    var method = 'personal_sign';\n    return callRpc(ethereum, method, params, fromAddress);\n  },\n  openSpaceConsent: function openSpaceConsent(fromAddress, ethereum, name) {\n    var text = \"Allow this app to open your \".concat(name, \" space.\");\n    if (ethereum.isAuthereum) return ethereum.signMessageWithSigningKey(text);\n    var msg = '0x' + Buffer.from(text, 'utf8').toString('hex');\n    var params = [msg, fromAddress];\n    var method = 'personal_sign';\n    return callRpc(ethereum, method, params, fromAddress);\n  },\n  fetchJson: function () {\n    var _fetchJson = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(url, body) {\n      var opts, r, res;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (body) {\n                opts = {\n                  body: JSON.stringify(body),\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json'\n                  }\n                };\n              }\n\n              _context2.next = 3;\n              return fetch(url, opts);\n\n            case 3:\n              r = _context2.sent;\n\n              if (!r.ok) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.next = 7;\n              return r.json();\n\n            case 7:\n              res = _context2.sent;\n              return _context2.abrupt(\"return\", res);\n\n            case 11:\n              _context2.t0 = HTTPError;\n              _context2.t1 = r.status;\n              _context2.next = 15;\n              return r.json();\n\n            case 15:\n              _context2.t2 = _context2.sent.message;\n              throw (0, _context2.t0)(_context2.t1, _context2.t2);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function fetchJson(_x5, _x6) {\n      return _fetchJson.apply(this, arguments);\n    }\n\n    return fetchJson;\n  }(),\n  fetchText: function () {\n    var _fetchText = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(url, opts) {\n      var r;\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return fetch(url, opts);\n\n            case 2:\n              r = _context3.sent;\n\n              if (!r.ok) {\n                _context3.next = 7;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", r.text());\n\n            case 7:\n              throw HTTPError(r.status, \"Invalid response (\".concat(r.status, \") for query at \").concat(url));\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function fetchText(_x7, _x8) {\n      return _fetchText.apply(this, arguments);\n    }\n\n    return fetchText;\n  }(),\n  throwIfUndefined: function throwIfUndefined(arg, name) {\n    if (arg === undefined || arg === null) {\n      throw new Error(\"\".concat(name, \" is a required argument\"));\n    }\n  },\n  throwIfNotEqualLenArrays: function throwIfNotEqualLenArrays(arr1, arr2) {\n    if (!Array.isArray(arr1) || !Array.isArray(arr2)) {\n      throw new Error('One or more arguments are not an array');\n    }\n\n    if (arr1.length !== arr2.length) {\n      throw new Error('Arrays must be of the same length');\n    }\n  },\n  sha256Multihash: function sha256Multihash(str) {\n    var digest = Buffer.from(sha256.digest(str));\n    return Multihash.encode(digest, 'sha2-256').toString('hex');\n  },\n  randInt: function randInt(max) {\n    return Math.floor(Math.random() * max);\n  },\n  sha256: sha256,\n  pad: pad,\n  unpad: unpad\n};","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/3box/lib/utils/index.js"],"names":["_interopRequireDefault","require","_regenerator","_asyncToGenerator2","fetch","window","Multihash","sha256","ENC_BLOCK_SIZE","MAGIC_ERC1271_VALUE","pad","val","blockSize","arguments","length","undefined","blockDiff","concat","repeat","unpad","padded","replace","HTTPError","status","message","e","Error","statusCode","getMessageConsent","did","timestamp","msg","safeSend","provider","data","send","Boolean","sendAsync","bind","Promise","resolve","reject","err","result","error","encodeRpcCall","method","params","fromAddress","jsonrpc","id","callRpc","_ref","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","stop","_x","_x2","_x3","_x4","apply","module","exports","openBoxConsent","ethereum","text","isAuthereum","signMessageWithSigningKey","Buffer","from","toString","openSpaceConsent","name","fetchJson","_fetchJson","_callee2","url","body","opts","r","res","_callee2$","_context2","JSON","stringify","headers","sent","ok","json","t0","t1","t2","_x5","_x6","fetchText","_fetchText","_callee3","_callee3$","_context3","_x7","_x8","throwIfUndefined","arg","throwIfNotEqualLenArrays","arr1","arr2","Array","isArray","sha256Multihash","str","digest","encode","randInt","max","Math","floor","random"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar fetch = typeof window !== 'undefined' ? window.fetch : require('node-fetch');\n\nvar Multihash = require('multihashes');\n\nvar sha256 = require('js-sha256').sha256;\n\nvar ENC_BLOCK_SIZE = 24;\nvar MAGIC_ERC1271_VALUE = '0x20c13b0b';\n\nvar pad = function pad(val) {\n  var blockSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ENC_BLOCK_SIZE;\n  var blockDiff = (blockSize - val.length % blockSize) % blockSize;\n  return \"\".concat(val).concat('\\0'.repeat(blockDiff));\n};\n\nvar unpad = function unpad(padded) {\n  return padded.replace(/\\0+$/, '');\n};\n\nvar HTTPError = function HTTPError(status, message) {\n  var e = new Error(message);\n  e.statusCode = status;\n  return e;\n};\n\nvar getMessageConsent = function getMessageConsent(did, timestamp) {\n  var msg = 'Create a new 3Box profile' + '\\n\\n' + '- \\n' + 'Your unique profile ID is ' + did;\n  if (timestamp) msg += ' \\n' + 'Timestamp: ' + timestamp;\n  return msg;\n};\n\nvar safeSend = function safeSend(provider, data) {\n  var send = (Boolean(provider.sendAsync) ? provider.sendAsync : provider.send).bind(provider);\n  return new Promise(function (resolve, reject) {\n    send(data, function (err, result) {\n      if (err) reject(err);else if (result.error) reject(result.error);else resolve(result.result);\n    });\n  });\n};\n\nvar encodeRpcCall = function encodeRpcCall(method, params, fromAddress) {\n  return {\n    jsonrpc: '2.0',\n    id: 1,\n    method: method,\n    params: params,\n    fromAddress: fromAddress\n  };\n};\n\nvar callRpc =\n/*#__PURE__*/\nfunction () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])(\n  /*#__PURE__*/\n  _regenerator[\"default\"].mark(function _callee(provider, method, params, fromAddress) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", safeSend(provider, encodeRpcCall(method, params, fromAddress)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function callRpc(_x, _x2, _x3, _x4) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nmodule.exports = {\n  getMessageConsent: getMessageConsent,\n  callRpc: callRpc,\n  openBoxConsent: function openBoxConsent(fromAddress, ethereum) {\n    var text = 'This app wants to view and update your 3Box profile.';\n    if (ethereum.isAuthereum) return ethereum.signMessageWithSigningKey(text);\n    var msg = '0x' + Buffer.from(text, 'utf8').toString('hex');\n    var params = [msg, fromAddress];\n    var method = 'personal_sign';\n    return callRpc(ethereum, method, params, fromAddress);\n  },\n  openSpaceConsent: function openSpaceConsent(fromAddress, ethereum, name) {\n    var text = \"Allow this app to open your \".concat(name, \" space.\");\n    if (ethereum.isAuthereum) return ethereum.signMessageWithSigningKey(text);\n    var msg = '0x' + Buffer.from(text, 'utf8').toString('hex');\n    var params = [msg, fromAddress];\n    var method = 'personal_sign';\n    return callRpc(ethereum, method, params, fromAddress);\n  },\n  fetchJson: function () {\n    var _fetchJson = (0, _asyncToGenerator2[\"default\"])(\n    /*#__PURE__*/\n    _regenerator[\"default\"].mark(function _callee2(url, body) {\n      var opts, r, res;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (body) {\n                opts = {\n                  body: JSON.stringify(body),\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json'\n                  }\n                };\n              }\n\n              _context2.next = 3;\n              return fetch(url, opts);\n\n            case 3:\n              r = _context2.sent;\n\n              if (!r.ok) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.next = 7;\n              return r.json();\n\n            case 7:\n              res = _context2.sent;\n              return _context2.abrupt(\"return\", res);\n\n            case 11:\n              _context2.t0 = HTTPError;\n              _context2.t1 = r.status;\n              _context2.next = 15;\n              return r.json();\n\n            case 15:\n              _context2.t2 = _context2.sent.message;\n              throw (0, _context2.t0)(_context2.t1, _context2.t2);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function fetchJson(_x5, _x6) {\n      return _fetchJson.apply(this, arguments);\n    }\n\n    return fetchJson;\n  }(),\n  fetchText: function () {\n    var _fetchText = (0, _asyncToGenerator2[\"default\"])(\n    /*#__PURE__*/\n    _regenerator[\"default\"].mark(function _callee3(url, opts) {\n      var r;\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return fetch(url, opts);\n\n            case 2:\n              r = _context3.sent;\n\n              if (!r.ok) {\n                _context3.next = 7;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", r.text());\n\n            case 7:\n              throw HTTPError(r.status, \"Invalid response (\".concat(r.status, \") for query at \").concat(url));\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function fetchText(_x7, _x8) {\n      return _fetchText.apply(this, arguments);\n    }\n\n    return fetchText;\n  }(),\n  throwIfUndefined: function throwIfUndefined(arg, name) {\n    if (arg === undefined || arg === null) {\n      throw new Error(\"\".concat(name, \" is a required argument\"));\n    }\n  },\n  throwIfNotEqualLenArrays: function throwIfNotEqualLenArrays(arr1, arr2) {\n    if (!Array.isArray(arr1) || !Array.isArray(arr2)) {\n      throw new Error('One or more arguments are not an array');\n    }\n\n    if (arr1.length !== arr2.length) {\n      throw new Error('Arrays must be of the same length');\n    }\n  },\n  sha256Multihash: function sha256Multihash(str) {\n    var digest = Buffer.from(sha256.digest(str));\n    return Multihash.encode(digest, 'sha2-256').toString('hex');\n  },\n  randInt: function randInt(max) {\n    return Math.floor(Math.random() * max);\n  },\n  sha256: sha256,\n  pad: pad,\n  unpad: unpad\n};"]},"metadata":{},"sourceType":"script"}